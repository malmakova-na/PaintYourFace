{"ast":null,"code":"\"use strict\";\n\nvar __extends = this && this.__extends || function () {\n  var extendStatics = function (d, b) {\n    extendStatics = Object.setPrototypeOf || {\n      __proto__: []\n    } instanceof Array && function (d, b) {\n      d.__proto__ = b;\n    } || function (d, b) {\n      for (var p in b) if (Object.prototype.hasOwnProperty.call(b, p)) d[p] = b[p];\n    };\n\n    return extendStatics(d, b);\n  };\n\n  return function (d, b) {\n    extendStatics(d, b);\n\n    function __() {\n      this.constructor = d;\n    }\n\n    d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());\n  };\n}();\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.HitContext = exports.SceneContext = exports.Context = void 0;\n\nvar Util_1 = require(\"./Util\");\n\nvar Global_1 = require(\"./Global\");\n\nvar COMMA = ',',\n    OPEN_PAREN = '(',\n    CLOSE_PAREN = ')',\n    OPEN_PAREN_BRACKET = '([',\n    CLOSE_BRACKET_PAREN = '])',\n    SEMICOLON = ';',\n    DOUBLE_PAREN = '()',\n    EQUALS = '=',\n    CONTEXT_METHODS = ['arc', 'arcTo', 'beginPath', 'bezierCurveTo', 'clearRect', 'clip', 'closePath', 'createLinearGradient', 'createPattern', 'createRadialGradient', 'drawImage', 'ellipse', 'fill', 'fillText', 'getImageData', 'createImageData', 'lineTo', 'moveTo', 'putImageData', 'quadraticCurveTo', 'rect', 'restore', 'rotate', 'save', 'scale', 'setLineDash', 'setTransform', 'stroke', 'strokeText', 'transform', 'translate'];\nvar CONTEXT_PROPERTIES = ['fillStyle', 'strokeStyle', 'shadowColor', 'shadowBlur', 'shadowOffsetX', 'shadowOffsetY', 'lineCap', 'lineDashOffset', 'lineJoin', 'lineWidth', 'miterLimit', 'font', 'textAlign', 'textBaseline', 'globalAlpha', 'globalCompositeOperation', 'imageSmoothingEnabled'];\nvar traceArrMax = 100;\n\nvar Context = function () {\n  function Context(canvas) {\n    this.canvas = canvas;\n    this._context = canvas._canvas.getContext('2d');\n\n    if (Global_1.Konva.enableTrace) {\n      this.traceArr = [];\n\n      this._enableTrace();\n    }\n  }\n\n  Context.prototype.fillShape = function (shape) {\n    if (shape.fillEnabled()) {\n      this._fill(shape);\n    }\n  };\n\n  Context.prototype._fill = function (shape) {};\n\n  Context.prototype.strokeShape = function (shape) {\n    if (shape.hasStroke()) {\n      this._stroke(shape);\n    }\n  };\n\n  Context.prototype._stroke = function (shape) {};\n\n  Context.prototype.fillStrokeShape = function (shape) {\n    if (shape.attrs.fillAfterStrokeEnabled) {\n      this.strokeShape(shape);\n      this.fillShape(shape);\n    } else {\n      this.fillShape(shape);\n      this.strokeShape(shape);\n    }\n  };\n\n  Context.prototype.getTrace = function (relaxed) {\n    var traceArr = this.traceArr,\n        len = traceArr.length,\n        str = '',\n        n,\n        trace,\n        method,\n        args;\n\n    for (n = 0; n < len; n++) {\n      trace = traceArr[n];\n      method = trace.method;\n\n      if (method) {\n        args = trace.args;\n        str += method;\n\n        if (relaxed) {\n          str += DOUBLE_PAREN;\n        } else {\n          if (Util_1.Util._isArray(args[0])) {\n            str += OPEN_PAREN_BRACKET + args.join(COMMA) + CLOSE_BRACKET_PAREN;\n          } else {\n            str += OPEN_PAREN + args.join(COMMA) + CLOSE_PAREN;\n          }\n        }\n      } else {\n        str += trace.property;\n\n        if (!relaxed) {\n          str += EQUALS + trace.val;\n        }\n      }\n\n      str += SEMICOLON;\n    }\n\n    return str;\n  };\n\n  Context.prototype.clearTrace = function () {\n    this.traceArr = [];\n  };\n\n  Context.prototype._trace = function (str) {\n    var traceArr = this.traceArr,\n        len;\n    traceArr.push(str);\n    len = traceArr.length;\n\n    if (len >= traceArrMax) {\n      traceArr.shift();\n    }\n  };\n\n  Context.prototype.reset = function () {\n    var pixelRatio = this.getCanvas().getPixelRatio();\n    this.setTransform(1 * pixelRatio, 0, 0, 1 * pixelRatio, 0, 0);\n  };\n\n  Context.prototype.getCanvas = function () {\n    return this.canvas;\n  };\n\n  Context.prototype.clear = function (bounds) {\n    var canvas = this.getCanvas();\n\n    if (bounds) {\n      this.clearRect(bounds.x || 0, bounds.y || 0, bounds.width || 0, bounds.height || 0);\n    } else {\n      this.clearRect(0, 0, canvas.getWidth() / canvas.pixelRatio, canvas.getHeight() / canvas.pixelRatio);\n    }\n  };\n\n  Context.prototype._applyLineCap = function (shape) {\n    var lineCap = shape.getLineCap();\n\n    if (lineCap) {\n      this.setAttr('lineCap', lineCap);\n    }\n  };\n\n  Context.prototype._applyOpacity = function (shape) {\n    var absOpacity = shape.getAbsoluteOpacity();\n\n    if (absOpacity !== 1) {\n      this.setAttr('globalAlpha', absOpacity);\n    }\n  };\n\n  Context.prototype._applyLineJoin = function (shape) {\n    var lineJoin = shape.attrs.lineJoin;\n\n    if (lineJoin) {\n      this.setAttr('lineJoin', lineJoin);\n    }\n  };\n\n  Context.prototype.setAttr = function (attr, val) {\n    this._context[attr] = val;\n  };\n\n  Context.prototype.arc = function (a0, a1, a2, a3, a4, a5) {\n    this._context.arc(a0, a1, a2, a3, a4, a5);\n  };\n\n  Context.prototype.arcTo = function (a0, a1, a2, a3, a4) {\n    this._context.arcTo(a0, a1, a2, a3, a4);\n  };\n\n  Context.prototype.beginPath = function () {\n    this._context.beginPath();\n  };\n\n  Context.prototype.bezierCurveTo = function (a0, a1, a2, a3, a4, a5) {\n    this._context.bezierCurveTo(a0, a1, a2, a3, a4, a5);\n  };\n\n  Context.prototype.clearRect = function (a0, a1, a2, a3) {\n    this._context.clearRect(a0, a1, a2, a3);\n  };\n\n  Context.prototype.clip = function () {\n    this._context.clip();\n  };\n\n  Context.prototype.closePath = function () {\n    this._context.closePath();\n  };\n\n  Context.prototype.createImageData = function (a0, a1) {\n    var a = arguments;\n\n    if (a.length === 2) {\n      return this._context.createImageData(a0, a1);\n    } else if (a.length === 1) {\n      return this._context.createImageData(a0);\n    }\n  };\n\n  Context.prototype.createLinearGradient = function (a0, a1, a2, a3) {\n    return this._context.createLinearGradient(a0, a1, a2, a3);\n  };\n\n  Context.prototype.createPattern = function (a0, a1) {\n    return this._context.createPattern(a0, a1);\n  };\n\n  Context.prototype.createRadialGradient = function (a0, a1, a2, a3, a4, a5) {\n    return this._context.createRadialGradient(a0, a1, a2, a3, a4, a5);\n  };\n\n  Context.prototype.drawImage = function (a0, a1, a2, a3, a4, a5, a6, a7, a8) {\n    var a = arguments,\n        _context = this._context;\n\n    if (a.length === 3) {\n      _context.drawImage(a0, a1, a2);\n    } else if (a.length === 5) {\n      _context.drawImage(a0, a1, a2, a3, a4);\n    } else if (a.length === 9) {\n      _context.drawImage(a0, a1, a2, a3, a4, a5, a6, a7, a8);\n    }\n  };\n\n  Context.prototype.ellipse = function (a0, a1, a2, a3, a4, a5, a6, a7) {\n    this._context.ellipse(a0, a1, a2, a3, a4, a5, a6, a7);\n  };\n\n  Context.prototype.isPointInPath = function (x, y) {\n    return this._context.isPointInPath(x, y);\n  };\n\n  Context.prototype.fill = function () {\n    this._context.fill();\n  };\n\n  Context.prototype.fillRect = function (x, y, width, height) {\n    this._context.fillRect(x, y, width, height);\n  };\n\n  Context.prototype.strokeRect = function (x, y, width, height) {\n    this._context.strokeRect(x, y, width, height);\n  };\n\n  Context.prototype.fillText = function (a0, a1, a2) {\n    this._context.fillText(a0, a1, a2);\n  };\n\n  Context.prototype.measureText = function (text) {\n    return this._context.measureText(text);\n  };\n\n  Context.prototype.getImageData = function (a0, a1, a2, a3) {\n    return this._context.getImageData(a0, a1, a2, a3);\n  };\n\n  Context.prototype.lineTo = function (a0, a1) {\n    this._context.lineTo(a0, a1);\n  };\n\n  Context.prototype.moveTo = function (a0, a1) {\n    this._context.moveTo(a0, a1);\n  };\n\n  Context.prototype.rect = function (a0, a1, a2, a3) {\n    this._context.rect(a0, a1, a2, a3);\n  };\n\n  Context.prototype.putImageData = function (a0, a1, a2) {\n    this._context.putImageData(a0, a1, a2);\n  };\n\n  Context.prototype.quadraticCurveTo = function (a0, a1, a2, a3) {\n    this._context.quadraticCurveTo(a0, a1, a2, a3);\n  };\n\n  Context.prototype.restore = function () {\n    this._context.restore();\n  };\n\n  Context.prototype.rotate = function (a0) {\n    this._context.rotate(a0);\n  };\n\n  Context.prototype.save = function () {\n    this._context.save();\n  };\n\n  Context.prototype.scale = function (a0, a1) {\n    this._context.scale(a0, a1);\n  };\n\n  Context.prototype.setLineDash = function (a0) {\n    if (this._context.setLineDash) {\n      this._context.setLineDash(a0);\n    } else if ('mozDash' in this._context) {\n      this._context['mozDash'] = a0;\n    } else if ('webkitLineDash' in this._context) {\n      this._context['webkitLineDash'] = a0;\n    }\n  };\n\n  Context.prototype.getLineDash = function () {\n    return this._context.getLineDash();\n  };\n\n  Context.prototype.setTransform = function (a0, a1, a2, a3, a4, a5) {\n    this._context.setTransform(a0, a1, a2, a3, a4, a5);\n  };\n\n  Context.prototype.stroke = function () {\n    this._context.stroke();\n  };\n\n  Context.prototype.strokeText = function (a0, a1, a2, a3) {\n    this._context.strokeText(a0, a1, a2, a3);\n  };\n\n  Context.prototype.transform = function (a0, a1, a2, a3, a4, a5) {\n    this._context.transform(a0, a1, a2, a3, a4, a5);\n  };\n\n  Context.prototype.translate = function (a0, a1) {\n    this._context.translate(a0, a1);\n  };\n\n  Context.prototype._enableTrace = function () {\n    var that = this,\n        len = CONTEXT_METHODS.length,\n        _simplifyArray = Util_1.Util._simplifyArray,\n        origSetter = this.setAttr,\n        n,\n        args;\n\n    var func = function (methodName) {\n      var origMethod = that[methodName],\n          ret;\n\n      that[methodName] = function () {\n        args = _simplifyArray(Array.prototype.slice.call(arguments, 0));\n        ret = origMethod.apply(that, arguments);\n\n        that._trace({\n          method: methodName,\n          args: args\n        });\n\n        return ret;\n      };\n    };\n\n    for (n = 0; n < len; n++) {\n      func(CONTEXT_METHODS[n]);\n    }\n\n    that.setAttr = function () {\n      origSetter.apply(that, arguments);\n      var prop = arguments[0];\n      var val = arguments[1];\n\n      if (prop === 'shadowOffsetX' || prop === 'shadowOffsetY' || prop === 'shadowBlur') {\n        val = val / this.canvas.getPixelRatio();\n      }\n\n      that._trace({\n        property: prop,\n        val: val\n      });\n    };\n  };\n\n  Context.prototype._applyGlobalCompositeOperation = function (node) {\n    var globalCompositeOperation = node.getGlobalCompositeOperation();\n\n    if (globalCompositeOperation !== 'source-over') {\n      this.setAttr('globalCompositeOperation', globalCompositeOperation);\n    }\n  };\n\n  return Context;\n}();\n\nexports.Context = Context;\nCONTEXT_PROPERTIES.forEach(function (prop) {\n  Object.defineProperty(Context.prototype, prop, {\n    get: function () {\n      return this._context[prop];\n    },\n    set: function (val) {\n      this._context[prop] = val;\n    }\n  });\n});\n\nvar SceneContext = function (_super) {\n  __extends(SceneContext, _super);\n\n  function SceneContext() {\n    return _super !== null && _super.apply(this, arguments) || this;\n  }\n\n  SceneContext.prototype._fillColor = function (shape) {\n    var fill = shape.fill();\n    this.setAttr('fillStyle', fill);\n\n    shape._fillFunc(this);\n  };\n\n  SceneContext.prototype._fillPattern = function (shape) {\n    var fillPatternX = shape.getFillPatternX(),\n        fillPatternY = shape.getFillPatternY(),\n        fillPatternRotation = Global_1.Konva.getAngle(shape.getFillPatternRotation()),\n        fillPatternOffsetX = shape.getFillPatternOffsetX(),\n        fillPatternOffsetY = shape.getFillPatternOffsetY(),\n        fillPatternScaleX = shape.getFillPatternScaleX(),\n        fillPatternScaleY = shape.getFillPatternScaleY();\n\n    if (fillPatternX || fillPatternY) {\n      this.translate(fillPatternX || 0, fillPatternY || 0);\n    }\n\n    if (fillPatternRotation) {\n      this.rotate(fillPatternRotation);\n    }\n\n    if (fillPatternScaleX || fillPatternScaleY) {}\n\n    if (fillPatternOffsetX || fillPatternOffsetY) {\n      this.translate(-1 * fillPatternOffsetX, -1 * fillPatternOffsetY);\n    }\n\n    this.setAttr('fillStyle', shape._getFillPattern());\n\n    shape._fillFunc(this);\n  };\n\n  SceneContext.prototype._fillLinearGradient = function (shape) {\n    var grd = shape._getLinearGradient();\n\n    if (grd) {\n      this.setAttr('fillStyle', grd);\n\n      shape._fillFunc(this);\n    }\n  };\n\n  SceneContext.prototype._fillRadialGradient = function (shape) {\n    var grd = shape._getRadialGradient();\n\n    if (grd) {\n      this.setAttr('fillStyle', grd);\n\n      shape._fillFunc(this);\n    }\n  };\n\n  SceneContext.prototype._fill = function (shape) {\n    var hasColor = shape.fill(),\n        fillPriority = shape.getFillPriority();\n\n    if (hasColor && fillPriority === 'color') {\n      this._fillColor(shape);\n\n      return;\n    }\n\n    var hasPattern = shape.getFillPatternImage();\n\n    if (hasPattern && fillPriority === 'pattern') {\n      this._fillPattern(shape);\n\n      return;\n    }\n\n    var hasLinearGradient = shape.getFillLinearGradientColorStops();\n\n    if (hasLinearGradient && fillPriority === 'linear-gradient') {\n      this._fillLinearGradient(shape);\n\n      return;\n    }\n\n    var hasRadialGradient = shape.getFillRadialGradientColorStops();\n\n    if (hasRadialGradient && fillPriority === 'radial-gradient') {\n      this._fillRadialGradient(shape);\n\n      return;\n    }\n\n    if (hasColor) {\n      this._fillColor(shape);\n    } else if (hasPattern) {\n      this._fillPattern(shape);\n    } else if (hasLinearGradient) {\n      this._fillLinearGradient(shape);\n    } else if (hasRadialGradient) {\n      this._fillRadialGradient(shape);\n    }\n  };\n\n  SceneContext.prototype._strokeLinearGradient = function (shape) {\n    var start = shape.getStrokeLinearGradientStartPoint(),\n        end = shape.getStrokeLinearGradientEndPoint(),\n        colorStops = shape.getStrokeLinearGradientColorStops(),\n        grd = this.createLinearGradient(start.x, start.y, end.x, end.y);\n\n    if (colorStops) {\n      for (var n = 0; n < colorStops.length; n += 2) {\n        grd.addColorStop(colorStops[n], colorStops[n + 1]);\n      }\n\n      this.setAttr('strokeStyle', grd);\n    }\n  };\n\n  SceneContext.prototype._stroke = function (shape) {\n    var dash = shape.dash(),\n        strokeScaleEnabled = shape.getStrokeScaleEnabled();\n\n    if (shape.hasStroke()) {\n      if (!strokeScaleEnabled) {\n        this.save();\n        var pixelRatio = this.getCanvas().getPixelRatio();\n        this.setTransform(pixelRatio, 0, 0, pixelRatio, 0, 0);\n      }\n\n      this._applyLineCap(shape);\n\n      if (dash && shape.dashEnabled()) {\n        this.setLineDash(dash);\n        this.setAttr('lineDashOffset', shape.dashOffset());\n      }\n\n      this.setAttr('lineWidth', shape.strokeWidth());\n\n      if (!shape.getShadowForStrokeEnabled()) {\n        this.setAttr('shadowColor', 'rgba(0,0,0,0)');\n      }\n\n      var hasLinearGradient = shape.getStrokeLinearGradientColorStops();\n\n      if (hasLinearGradient) {\n        this._strokeLinearGradient(shape);\n      } else {\n        this.setAttr('strokeStyle', shape.stroke());\n      }\n\n      shape._strokeFunc(this);\n\n      if (!strokeScaleEnabled) {\n        this.restore();\n      }\n    }\n  };\n\n  SceneContext.prototype._applyShadow = function (shape) {\n    var util = Util_1.Util,\n        color = util.get(shape.getShadowRGBA(), 'black'),\n        blur = util.get(shape.getShadowBlur(), 5),\n        offset = util.get(shape.getShadowOffset(), {\n      x: 0,\n      y: 0\n    }),\n        scale = shape.getAbsoluteScale(),\n        ratio = this.canvas.getPixelRatio(),\n        scaleX = scale.x * ratio,\n        scaleY = scale.y * ratio;\n    this.setAttr('shadowColor', color);\n    this.setAttr('shadowBlur', blur * Math.min(Math.abs(scaleX), Math.abs(scaleY)));\n    this.setAttr('shadowOffsetX', offset.x * scaleX);\n    this.setAttr('shadowOffsetY', offset.y * scaleY);\n  };\n\n  return SceneContext;\n}(Context);\n\nexports.SceneContext = SceneContext;\n\nvar HitContext = function (_super) {\n  __extends(HitContext, _super);\n\n  function HitContext() {\n    return _super !== null && _super.apply(this, arguments) || this;\n  }\n\n  HitContext.prototype._fill = function (shape) {\n    this.save();\n    this.setAttr('fillStyle', shape.colorKey);\n\n    shape._fillFuncHit(this);\n\n    this.restore();\n  };\n\n  HitContext.prototype.strokeShape = function (shape) {\n    if (shape.hasHitStroke()) {\n      this._stroke(shape);\n    }\n  };\n\n  HitContext.prototype._stroke = function (shape) {\n    if (shape.hasHitStroke()) {\n      var strokeScaleEnabled = shape.getStrokeScaleEnabled();\n\n      if (!strokeScaleEnabled) {\n        this.save();\n        var pixelRatio = this.getCanvas().getPixelRatio();\n        this.setTransform(pixelRatio, 0, 0, pixelRatio, 0, 0);\n      }\n\n      this._applyLineCap(shape);\n\n      var hitStrokeWidth = shape.hitStrokeWidth();\n      var strokeWidth = hitStrokeWidth === 'auto' ? shape.strokeWidth() : hitStrokeWidth;\n      this.setAttr('lineWidth', strokeWidth);\n      this.setAttr('strokeStyle', shape.colorKey);\n\n      shape._strokeFuncHit(this);\n\n      if (!strokeScaleEnabled) {\n        this.restore();\n      }\n    }\n  };\n\n  return HitContext;\n}(Context);\n\nexports.HitContext = HitContext;","map":{"version":3,"sources":["/home/namina/courses/tinkoff/paint-your-face/node_modules/konva/lib/Context.js"],"names":["__extends","extendStatics","d","b","Object","setPrototypeOf","__proto__","Array","p","prototype","hasOwnProperty","call","__","constructor","create","defineProperty","exports","value","HitContext","SceneContext","Context","Util_1","require","Global_1","COMMA","OPEN_PAREN","CLOSE_PAREN","OPEN_PAREN_BRACKET","CLOSE_BRACKET_PAREN","SEMICOLON","DOUBLE_PAREN","EQUALS","CONTEXT_METHODS","CONTEXT_PROPERTIES","traceArrMax","canvas","_context","_canvas","getContext","Konva","enableTrace","traceArr","_enableTrace","fillShape","shape","fillEnabled","_fill","strokeShape","hasStroke","_stroke","fillStrokeShape","attrs","fillAfterStrokeEnabled","getTrace","relaxed","len","length","str","n","trace","method","args","Util","_isArray","join","property","val","clearTrace","_trace","push","shift","reset","pixelRatio","getCanvas","getPixelRatio","setTransform","clear","bounds","clearRect","x","y","width","height","getWidth","getHeight","_applyLineCap","lineCap","getLineCap","setAttr","_applyOpacity","absOpacity","getAbsoluteOpacity","_applyLineJoin","lineJoin","attr","arc","a0","a1","a2","a3","a4","a5","arcTo","beginPath","bezierCurveTo","clip","closePath","createImageData","a","arguments","createLinearGradient","createPattern","createRadialGradient","drawImage","a6","a7","a8","ellipse","isPointInPath","fill","fillRect","strokeRect","fillText","measureText","text","getImageData","lineTo","moveTo","rect","putImageData","quadraticCurveTo","restore","rotate","save","scale","setLineDash","getLineDash","stroke","strokeText","transform","translate","that","_simplifyArray","origSetter","func","methodName","origMethod","ret","slice","apply","prop","_applyGlobalCompositeOperation","node","globalCompositeOperation","getGlobalCompositeOperation","forEach","get","set","_super","_fillColor","_fillFunc","_fillPattern","fillPatternX","getFillPatternX","fillPatternY","getFillPatternY","fillPatternRotation","getAngle","getFillPatternRotation","fillPatternOffsetX","getFillPatternOffsetX","fillPatternOffsetY","getFillPatternOffsetY","fillPatternScaleX","getFillPatternScaleX","fillPatternScaleY","getFillPatternScaleY","_getFillPattern","_fillLinearGradient","grd","_getLinearGradient","_fillRadialGradient","_getRadialGradient","hasColor","fillPriority","getFillPriority","hasPattern","getFillPatternImage","hasLinearGradient","getFillLinearGradientColorStops","hasRadialGradient","getFillRadialGradientColorStops","_strokeLinearGradient","start","getStrokeLinearGradientStartPoint","end","getStrokeLinearGradientEndPoint","colorStops","getStrokeLinearGradientColorStops","addColorStop","dash","strokeScaleEnabled","getStrokeScaleEnabled","dashEnabled","dashOffset","strokeWidth","getShadowForStrokeEnabled","_strokeFunc","_applyShadow","util","color","getShadowRGBA","blur","getShadowBlur","offset","getShadowOffset","getAbsoluteScale","ratio","scaleX","scaleY","Math","min","abs","colorKey","_fillFuncHit","hasHitStroke","hitStrokeWidth","_strokeFuncHit"],"mappings":"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","sourcesContent":["\"use strict\";\nvar __extends = (this && this.__extends) || (function () {\n    var extendStatics = function (d, b) {\n        extendStatics = Object.setPrototypeOf ||\n            ({ __proto__: [] } instanceof Array && function (d, b) { d.__proto__ = b; }) ||\n            function (d, b) { for (var p in b) if (Object.prototype.hasOwnProperty.call(b, p)) d[p] = b[p]; };\n        return extendStatics(d, b);\n    };\n    return function (d, b) {\n        extendStatics(d, b);\n        function __() { this.constructor = d; }\n        d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());\n    };\n})();\nObject.defineProperty(exports, \"__esModule\", { value: true });\nexports.HitContext = exports.SceneContext = exports.Context = void 0;\nvar Util_1 = require(\"./Util\");\nvar Global_1 = require(\"./Global\");\nvar COMMA = ',', OPEN_PAREN = '(', CLOSE_PAREN = ')', OPEN_PAREN_BRACKET = '([', CLOSE_BRACKET_PAREN = '])', SEMICOLON = ';', DOUBLE_PAREN = '()', EQUALS = '=', CONTEXT_METHODS = [\n    'arc',\n    'arcTo',\n    'beginPath',\n    'bezierCurveTo',\n    'clearRect',\n    'clip',\n    'closePath',\n    'createLinearGradient',\n    'createPattern',\n    'createRadialGradient',\n    'drawImage',\n    'ellipse',\n    'fill',\n    'fillText',\n    'getImageData',\n    'createImageData',\n    'lineTo',\n    'moveTo',\n    'putImageData',\n    'quadraticCurveTo',\n    'rect',\n    'restore',\n    'rotate',\n    'save',\n    'scale',\n    'setLineDash',\n    'setTransform',\n    'stroke',\n    'strokeText',\n    'transform',\n    'translate',\n];\nvar CONTEXT_PROPERTIES = [\n    'fillStyle',\n    'strokeStyle',\n    'shadowColor',\n    'shadowBlur',\n    'shadowOffsetX',\n    'shadowOffsetY',\n    'lineCap',\n    'lineDashOffset',\n    'lineJoin',\n    'lineWidth',\n    'miterLimit',\n    'font',\n    'textAlign',\n    'textBaseline',\n    'globalAlpha',\n    'globalCompositeOperation',\n    'imageSmoothingEnabled',\n];\nvar traceArrMax = 100;\nvar Context = (function () {\n    function Context(canvas) {\n        this.canvas = canvas;\n        this._context = canvas._canvas.getContext('2d');\n        if (Global_1.Konva.enableTrace) {\n            this.traceArr = [];\n            this._enableTrace();\n        }\n    }\n    Context.prototype.fillShape = function (shape) {\n        if (shape.fillEnabled()) {\n            this._fill(shape);\n        }\n    };\n    Context.prototype._fill = function (shape) {\n    };\n    Context.prototype.strokeShape = function (shape) {\n        if (shape.hasStroke()) {\n            this._stroke(shape);\n        }\n    };\n    Context.prototype._stroke = function (shape) {\n    };\n    Context.prototype.fillStrokeShape = function (shape) {\n        if (shape.attrs.fillAfterStrokeEnabled) {\n            this.strokeShape(shape);\n            this.fillShape(shape);\n        }\n        else {\n            this.fillShape(shape);\n            this.strokeShape(shape);\n        }\n    };\n    Context.prototype.getTrace = function (relaxed) {\n        var traceArr = this.traceArr, len = traceArr.length, str = '', n, trace, method, args;\n        for (n = 0; n < len; n++) {\n            trace = traceArr[n];\n            method = trace.method;\n            if (method) {\n                args = trace.args;\n                str += method;\n                if (relaxed) {\n                    str += DOUBLE_PAREN;\n                }\n                else {\n                    if (Util_1.Util._isArray(args[0])) {\n                        str += OPEN_PAREN_BRACKET + args.join(COMMA) + CLOSE_BRACKET_PAREN;\n                    }\n                    else {\n                        str += OPEN_PAREN + args.join(COMMA) + CLOSE_PAREN;\n                    }\n                }\n            }\n            else {\n                str += trace.property;\n                if (!relaxed) {\n                    str += EQUALS + trace.val;\n                }\n            }\n            str += SEMICOLON;\n        }\n        return str;\n    };\n    Context.prototype.clearTrace = function () {\n        this.traceArr = [];\n    };\n    Context.prototype._trace = function (str) {\n        var traceArr = this.traceArr, len;\n        traceArr.push(str);\n        len = traceArr.length;\n        if (len >= traceArrMax) {\n            traceArr.shift();\n        }\n    };\n    Context.prototype.reset = function () {\n        var pixelRatio = this.getCanvas().getPixelRatio();\n        this.setTransform(1 * pixelRatio, 0, 0, 1 * pixelRatio, 0, 0);\n    };\n    Context.prototype.getCanvas = function () {\n        return this.canvas;\n    };\n    Context.prototype.clear = function (bounds) {\n        var canvas = this.getCanvas();\n        if (bounds) {\n            this.clearRect(bounds.x || 0, bounds.y || 0, bounds.width || 0, bounds.height || 0);\n        }\n        else {\n            this.clearRect(0, 0, canvas.getWidth() / canvas.pixelRatio, canvas.getHeight() / canvas.pixelRatio);\n        }\n    };\n    Context.prototype._applyLineCap = function (shape) {\n        var lineCap = shape.getLineCap();\n        if (lineCap) {\n            this.setAttr('lineCap', lineCap);\n        }\n    };\n    Context.prototype._applyOpacity = function (shape) {\n        var absOpacity = shape.getAbsoluteOpacity();\n        if (absOpacity !== 1) {\n            this.setAttr('globalAlpha', absOpacity);\n        }\n    };\n    Context.prototype._applyLineJoin = function (shape) {\n        var lineJoin = shape.attrs.lineJoin;\n        if (lineJoin) {\n            this.setAttr('lineJoin', lineJoin);\n        }\n    };\n    Context.prototype.setAttr = function (attr, val) {\n        this._context[attr] = val;\n    };\n    Context.prototype.arc = function (a0, a1, a2, a3, a4, a5) {\n        this._context.arc(a0, a1, a2, a3, a4, a5);\n    };\n    Context.prototype.arcTo = function (a0, a1, a2, a3, a4) {\n        this._context.arcTo(a0, a1, a2, a3, a4);\n    };\n    Context.prototype.beginPath = function () {\n        this._context.beginPath();\n    };\n    Context.prototype.bezierCurveTo = function (a0, a1, a2, a3, a4, a5) {\n        this._context.bezierCurveTo(a0, a1, a2, a3, a4, a5);\n    };\n    Context.prototype.clearRect = function (a0, a1, a2, a3) {\n        this._context.clearRect(a0, a1, a2, a3);\n    };\n    Context.prototype.clip = function () {\n        this._context.clip();\n    };\n    Context.prototype.closePath = function () {\n        this._context.closePath();\n    };\n    Context.prototype.createImageData = function (a0, a1) {\n        var a = arguments;\n        if (a.length === 2) {\n            return this._context.createImageData(a0, a1);\n        }\n        else if (a.length === 1) {\n            return this._context.createImageData(a0);\n        }\n    };\n    Context.prototype.createLinearGradient = function (a0, a1, a2, a3) {\n        return this._context.createLinearGradient(a0, a1, a2, a3);\n    };\n    Context.prototype.createPattern = function (a0, a1) {\n        return this._context.createPattern(a0, a1);\n    };\n    Context.prototype.createRadialGradient = function (a0, a1, a2, a3, a4, a5) {\n        return this._context.createRadialGradient(a0, a1, a2, a3, a4, a5);\n    };\n    Context.prototype.drawImage = function (a0, a1, a2, a3, a4, a5, a6, a7, a8) {\n        var a = arguments, _context = this._context;\n        if (a.length === 3) {\n            _context.drawImage(a0, a1, a2);\n        }\n        else if (a.length === 5) {\n            _context.drawImage(a0, a1, a2, a3, a4);\n        }\n        else if (a.length === 9) {\n            _context.drawImage(a0, a1, a2, a3, a4, a5, a6, a7, a8);\n        }\n    };\n    Context.prototype.ellipse = function (a0, a1, a2, a3, a4, a5, a6, a7) {\n        this._context.ellipse(a0, a1, a2, a3, a4, a5, a6, a7);\n    };\n    Context.prototype.isPointInPath = function (x, y) {\n        return this._context.isPointInPath(x, y);\n    };\n    Context.prototype.fill = function () {\n        this._context.fill();\n    };\n    Context.prototype.fillRect = function (x, y, width, height) {\n        this._context.fillRect(x, y, width, height);\n    };\n    Context.prototype.strokeRect = function (x, y, width, height) {\n        this._context.strokeRect(x, y, width, height);\n    };\n    Context.prototype.fillText = function (a0, a1, a2) {\n        this._context.fillText(a0, a1, a2);\n    };\n    Context.prototype.measureText = function (text) {\n        return this._context.measureText(text);\n    };\n    Context.prototype.getImageData = function (a0, a1, a2, a3) {\n        return this._context.getImageData(a0, a1, a2, a3);\n    };\n    Context.prototype.lineTo = function (a0, a1) {\n        this._context.lineTo(a0, a1);\n    };\n    Context.prototype.moveTo = function (a0, a1) {\n        this._context.moveTo(a0, a1);\n    };\n    Context.prototype.rect = function (a0, a1, a2, a3) {\n        this._context.rect(a0, a1, a2, a3);\n    };\n    Context.prototype.putImageData = function (a0, a1, a2) {\n        this._context.putImageData(a0, a1, a2);\n    };\n    Context.prototype.quadraticCurveTo = function (a0, a1, a2, a3) {\n        this._context.quadraticCurveTo(a0, a1, a2, a3);\n    };\n    Context.prototype.restore = function () {\n        this._context.restore();\n    };\n    Context.prototype.rotate = function (a0) {\n        this._context.rotate(a0);\n    };\n    Context.prototype.save = function () {\n        this._context.save();\n    };\n    Context.prototype.scale = function (a0, a1) {\n        this._context.scale(a0, a1);\n    };\n    Context.prototype.setLineDash = function (a0) {\n        if (this._context.setLineDash) {\n            this._context.setLineDash(a0);\n        }\n        else if ('mozDash' in this._context) {\n            this._context['mozDash'] = a0;\n        }\n        else if ('webkitLineDash' in this._context) {\n            this._context['webkitLineDash'] = a0;\n        }\n    };\n    Context.prototype.getLineDash = function () {\n        return this._context.getLineDash();\n    };\n    Context.prototype.setTransform = function (a0, a1, a2, a3, a4, a5) {\n        this._context.setTransform(a0, a1, a2, a3, a4, a5);\n    };\n    Context.prototype.stroke = function () {\n        this._context.stroke();\n    };\n    Context.prototype.strokeText = function (a0, a1, a2, a3) {\n        this._context.strokeText(a0, a1, a2, a3);\n    };\n    Context.prototype.transform = function (a0, a1, a2, a3, a4, a5) {\n        this._context.transform(a0, a1, a2, a3, a4, a5);\n    };\n    Context.prototype.translate = function (a0, a1) {\n        this._context.translate(a0, a1);\n    };\n    Context.prototype._enableTrace = function () {\n        var that = this, len = CONTEXT_METHODS.length, _simplifyArray = Util_1.Util._simplifyArray, origSetter = this.setAttr, n, args;\n        var func = function (methodName) {\n            var origMethod = that[methodName], ret;\n            that[methodName] = function () {\n                args = _simplifyArray(Array.prototype.slice.call(arguments, 0));\n                ret = origMethod.apply(that, arguments);\n                that._trace({\n                    method: methodName,\n                    args: args,\n                });\n                return ret;\n            };\n        };\n        for (n = 0; n < len; n++) {\n            func(CONTEXT_METHODS[n]);\n        }\n        that.setAttr = function () {\n            origSetter.apply(that, arguments);\n            var prop = arguments[0];\n            var val = arguments[1];\n            if (prop === 'shadowOffsetX' ||\n                prop === 'shadowOffsetY' ||\n                prop === 'shadowBlur') {\n                val = val / this.canvas.getPixelRatio();\n            }\n            that._trace({\n                property: prop,\n                val: val,\n            });\n        };\n    };\n    Context.prototype._applyGlobalCompositeOperation = function (node) {\n        var globalCompositeOperation = node.getGlobalCompositeOperation();\n        if (globalCompositeOperation !== 'source-over') {\n            this.setAttr('globalCompositeOperation', globalCompositeOperation);\n        }\n    };\n    return Context;\n}());\nexports.Context = Context;\nCONTEXT_PROPERTIES.forEach(function (prop) {\n    Object.defineProperty(Context.prototype, prop, {\n        get: function () {\n            return this._context[prop];\n        },\n        set: function (val) {\n            this._context[prop] = val;\n        },\n    });\n});\nvar SceneContext = (function (_super) {\n    __extends(SceneContext, _super);\n    function SceneContext() {\n        return _super !== null && _super.apply(this, arguments) || this;\n    }\n    SceneContext.prototype._fillColor = function (shape) {\n        var fill = shape.fill();\n        this.setAttr('fillStyle', fill);\n        shape._fillFunc(this);\n    };\n    SceneContext.prototype._fillPattern = function (shape) {\n        var fillPatternX = shape.getFillPatternX(), fillPatternY = shape.getFillPatternY(), fillPatternRotation = Global_1.Konva.getAngle(shape.getFillPatternRotation()), fillPatternOffsetX = shape.getFillPatternOffsetX(), fillPatternOffsetY = shape.getFillPatternOffsetY(), fillPatternScaleX = shape.getFillPatternScaleX(), fillPatternScaleY = shape.getFillPatternScaleY();\n        if (fillPatternX || fillPatternY) {\n            this.translate(fillPatternX || 0, fillPatternY || 0);\n        }\n        if (fillPatternRotation) {\n            this.rotate(fillPatternRotation);\n        }\n        if (fillPatternScaleX || fillPatternScaleY) {\n        }\n        if (fillPatternOffsetX || fillPatternOffsetY) {\n            this.translate(-1 * fillPatternOffsetX, -1 * fillPatternOffsetY);\n        }\n        this.setAttr('fillStyle', shape._getFillPattern());\n        shape._fillFunc(this);\n    };\n    SceneContext.prototype._fillLinearGradient = function (shape) {\n        var grd = shape._getLinearGradient();\n        if (grd) {\n            this.setAttr('fillStyle', grd);\n            shape._fillFunc(this);\n        }\n    };\n    SceneContext.prototype._fillRadialGradient = function (shape) {\n        var grd = shape._getRadialGradient();\n        if (grd) {\n            this.setAttr('fillStyle', grd);\n            shape._fillFunc(this);\n        }\n    };\n    SceneContext.prototype._fill = function (shape) {\n        var hasColor = shape.fill(), fillPriority = shape.getFillPriority();\n        if (hasColor && fillPriority === 'color') {\n            this._fillColor(shape);\n            return;\n        }\n        var hasPattern = shape.getFillPatternImage();\n        if (hasPattern && fillPriority === 'pattern') {\n            this._fillPattern(shape);\n            return;\n        }\n        var hasLinearGradient = shape.getFillLinearGradientColorStops();\n        if (hasLinearGradient && fillPriority === 'linear-gradient') {\n            this._fillLinearGradient(shape);\n            return;\n        }\n        var hasRadialGradient = shape.getFillRadialGradientColorStops();\n        if (hasRadialGradient && fillPriority === 'radial-gradient') {\n            this._fillRadialGradient(shape);\n            return;\n        }\n        if (hasColor) {\n            this._fillColor(shape);\n        }\n        else if (hasPattern) {\n            this._fillPattern(shape);\n        }\n        else if (hasLinearGradient) {\n            this._fillLinearGradient(shape);\n        }\n        else if (hasRadialGradient) {\n            this._fillRadialGradient(shape);\n        }\n    };\n    SceneContext.prototype._strokeLinearGradient = function (shape) {\n        var start = shape.getStrokeLinearGradientStartPoint(), end = shape.getStrokeLinearGradientEndPoint(), colorStops = shape.getStrokeLinearGradientColorStops(), grd = this.createLinearGradient(start.x, start.y, end.x, end.y);\n        if (colorStops) {\n            for (var n = 0; n < colorStops.length; n += 2) {\n                grd.addColorStop(colorStops[n], colorStops[n + 1]);\n            }\n            this.setAttr('strokeStyle', grd);\n        }\n    };\n    SceneContext.prototype._stroke = function (shape) {\n        var dash = shape.dash(), strokeScaleEnabled = shape.getStrokeScaleEnabled();\n        if (shape.hasStroke()) {\n            if (!strokeScaleEnabled) {\n                this.save();\n                var pixelRatio = this.getCanvas().getPixelRatio();\n                this.setTransform(pixelRatio, 0, 0, pixelRatio, 0, 0);\n            }\n            this._applyLineCap(shape);\n            if (dash && shape.dashEnabled()) {\n                this.setLineDash(dash);\n                this.setAttr('lineDashOffset', shape.dashOffset());\n            }\n            this.setAttr('lineWidth', shape.strokeWidth());\n            if (!shape.getShadowForStrokeEnabled()) {\n                this.setAttr('shadowColor', 'rgba(0,0,0,0)');\n            }\n            var hasLinearGradient = shape.getStrokeLinearGradientColorStops();\n            if (hasLinearGradient) {\n                this._strokeLinearGradient(shape);\n            }\n            else {\n                this.setAttr('strokeStyle', shape.stroke());\n            }\n            shape._strokeFunc(this);\n            if (!strokeScaleEnabled) {\n                this.restore();\n            }\n        }\n    };\n    SceneContext.prototype._applyShadow = function (shape) {\n        var util = Util_1.Util, color = util.get(shape.getShadowRGBA(), 'black'), blur = util.get(shape.getShadowBlur(), 5), offset = util.get(shape.getShadowOffset(), {\n            x: 0,\n            y: 0,\n        }), scale = shape.getAbsoluteScale(), ratio = this.canvas.getPixelRatio(), scaleX = scale.x * ratio, scaleY = scale.y * ratio;\n        this.setAttr('shadowColor', color);\n        this.setAttr('shadowBlur', blur * Math.min(Math.abs(scaleX), Math.abs(scaleY)));\n        this.setAttr('shadowOffsetX', offset.x * scaleX);\n        this.setAttr('shadowOffsetY', offset.y * scaleY);\n    };\n    return SceneContext;\n}(Context));\nexports.SceneContext = SceneContext;\nvar HitContext = (function (_super) {\n    __extends(HitContext, _super);\n    function HitContext() {\n        return _super !== null && _super.apply(this, arguments) || this;\n    }\n    HitContext.prototype._fill = function (shape) {\n        this.save();\n        this.setAttr('fillStyle', shape.colorKey);\n        shape._fillFuncHit(this);\n        this.restore();\n    };\n    HitContext.prototype.strokeShape = function (shape) {\n        if (shape.hasHitStroke()) {\n            this._stroke(shape);\n        }\n    };\n    HitContext.prototype._stroke = function (shape) {\n        if (shape.hasHitStroke()) {\n            var strokeScaleEnabled = shape.getStrokeScaleEnabled();\n            if (!strokeScaleEnabled) {\n                this.save();\n                var pixelRatio = this.getCanvas().getPixelRatio();\n                this.setTransform(pixelRatio, 0, 0, pixelRatio, 0, 0);\n            }\n            this._applyLineCap(shape);\n            var hitStrokeWidth = shape.hitStrokeWidth();\n            var strokeWidth = hitStrokeWidth === 'auto' ? shape.strokeWidth() : hitStrokeWidth;\n            this.setAttr('lineWidth', strokeWidth);\n            this.setAttr('strokeStyle', shape.colorKey);\n            shape._strokeFuncHit(this);\n            if (!strokeScaleEnabled) {\n                this.restore();\n            }\n        }\n    };\n    return HitContext;\n}(Context));\nexports.HitContext = HitContext;\n"]},"metadata":{},"sourceType":"script"}