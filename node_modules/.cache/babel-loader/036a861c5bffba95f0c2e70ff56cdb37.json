{"ast":null,"code":"\"use strict\";\n\nvar __extends = this && this.__extends || function () {\n  var extendStatics = function (d, b) {\n    extendStatics = Object.setPrototypeOf || {\n      __proto__: []\n    } instanceof Array && function (d, b) {\n      d.__proto__ = b;\n    } || function (d, b) {\n      for (var p in b) if (Object.prototype.hasOwnProperty.call(b, p)) d[p] = b[p];\n    };\n\n    return extendStatics(d, b);\n  };\n\n  return function (d, b) {\n    extendStatics(d, b);\n\n    function __() {\n      this.constructor = d;\n    }\n\n    d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());\n  };\n}();\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.Layer = void 0;\n\nvar Util_1 = require(\"./Util\");\n\nvar Container_1 = require(\"./Container\");\n\nvar Node_1 = require(\"./Node\");\n\nvar Factory_1 = require(\"./Factory\");\n\nvar Canvas_1 = require(\"./Canvas\");\n\nvar Validators_1 = require(\"./Validators\");\n\nvar Shape_1 = require(\"./Shape\");\n\nvar Global_1 = require(\"./Global\");\n\nvar HASH = '#',\n    BEFORE_DRAW = 'beforeDraw',\n    DRAW = 'draw',\n    INTERSECTION_OFFSETS = [{\n  x: 0,\n  y: 0\n}, {\n  x: -1,\n  y: -1\n}, {\n  x: 1,\n  y: -1\n}, {\n  x: 1,\n  y: 1\n}, {\n  x: -1,\n  y: 1\n}],\n    INTERSECTION_OFFSETS_LEN = INTERSECTION_OFFSETS.length;\n\nvar Layer = function (_super) {\n  __extends(Layer, _super);\n\n  function Layer(config) {\n    var _this = _super.call(this, config) || this;\n\n    _this.canvas = new Canvas_1.SceneCanvas();\n    _this.hitCanvas = new Canvas_1.HitCanvas({\n      pixelRatio: 1\n    });\n    _this._waitingForDraw = false;\n\n    _this.on('visibleChange.konva', _this._checkVisibility);\n\n    _this._checkVisibility();\n\n    _this.on('imageSmoothingEnabledChange.konva', _this._setSmoothEnabled);\n\n    _this._setSmoothEnabled();\n\n    return _this;\n  }\n\n  Layer.prototype.createPNGStream = function () {\n    var c = this.canvas._canvas;\n    return c.createPNGStream();\n  };\n\n  Layer.prototype.getCanvas = function () {\n    return this.canvas;\n  };\n\n  Layer.prototype.getHitCanvas = function () {\n    return this.hitCanvas;\n  };\n\n  Layer.prototype.getContext = function () {\n    return this.getCanvas().getContext();\n  };\n\n  Layer.prototype.clear = function (bounds) {\n    this.getContext().clear(bounds);\n    this.getHitCanvas().getContext().clear(bounds);\n    return this;\n  };\n\n  Layer.prototype.setZIndex = function (index) {\n    _super.prototype.setZIndex.call(this, index);\n\n    var stage = this.getStage();\n\n    if (stage) {\n      stage.content.removeChild(this.getCanvas()._canvas);\n\n      if (index < stage.children.length - 1) {\n        stage.content.insertBefore(this.getCanvas()._canvas, stage.children[index + 1].getCanvas()._canvas);\n      } else {\n        stage.content.appendChild(this.getCanvas()._canvas);\n      }\n    }\n\n    return this;\n  };\n\n  Layer.prototype.moveToTop = function () {\n    Node_1.Node.prototype.moveToTop.call(this);\n    var stage = this.getStage();\n\n    if (stage) {\n      stage.content.removeChild(this.getCanvas()._canvas);\n      stage.content.appendChild(this.getCanvas()._canvas);\n    }\n\n    return true;\n  };\n\n  Layer.prototype.moveUp = function () {\n    var moved = Node_1.Node.prototype.moveUp.call(this);\n\n    if (!moved) {\n      return false;\n    }\n\n    var stage = this.getStage();\n\n    if (!stage) {\n      return false;\n    }\n\n    stage.content.removeChild(this.getCanvas()._canvas);\n\n    if (this.index < stage.children.length - 1) {\n      stage.content.insertBefore(this.getCanvas()._canvas, stage.children[this.index + 1].getCanvas()._canvas);\n    } else {\n      stage.content.appendChild(this.getCanvas()._canvas);\n    }\n\n    return true;\n  };\n\n  Layer.prototype.moveDown = function () {\n    if (Node_1.Node.prototype.moveDown.call(this)) {\n      var stage = this.getStage();\n\n      if (stage) {\n        var children = stage.children;\n        stage.content.removeChild(this.getCanvas()._canvas);\n        stage.content.insertBefore(this.getCanvas()._canvas, children[this.index + 1].getCanvas()._canvas);\n      }\n\n      return true;\n    }\n\n    return false;\n  };\n\n  Layer.prototype.moveToBottom = function () {\n    if (Node_1.Node.prototype.moveToBottom.call(this)) {\n      var stage = this.getStage();\n\n      if (stage) {\n        var children = stage.children;\n        stage.content.removeChild(this.getCanvas()._canvas);\n        stage.content.insertBefore(this.getCanvas()._canvas, children[1].getCanvas()._canvas);\n      }\n\n      return true;\n    }\n\n    return false;\n  };\n\n  Layer.prototype.getLayer = function () {\n    return this;\n  };\n\n  Layer.prototype.remove = function () {\n    var _canvas = this.getCanvas()._canvas;\n\n    Node_1.Node.prototype.remove.call(this);\n\n    if (_canvas && _canvas.parentNode && Util_1.Util._isInDocument(_canvas)) {\n      _canvas.parentNode.removeChild(_canvas);\n    }\n\n    return this;\n  };\n\n  Layer.prototype.getStage = function () {\n    return this.parent;\n  };\n\n  Layer.prototype.setSize = function (_a) {\n    var width = _a.width,\n        height = _a.height;\n    this.canvas.setSize(width, height);\n    this.hitCanvas.setSize(width, height);\n\n    this._setSmoothEnabled();\n\n    return this;\n  };\n\n  Layer.prototype._validateAdd = function (child) {\n    var type = child.getType();\n\n    if (type !== 'Group' && type !== 'Shape') {\n      Util_1.Util.throw('You may only add groups and shapes to a layer.');\n    }\n  };\n\n  Layer.prototype._toKonvaCanvas = function (config) {\n    config = config || {};\n    config.width = config.width || this.getWidth();\n    config.height = config.height || this.getHeight();\n    config.x = config.x !== undefined ? config.x : this.x();\n    config.y = config.y !== undefined ? config.y : this.y();\n    return Node_1.Node.prototype._toKonvaCanvas.call(this, config);\n  };\n\n  Layer.prototype._checkVisibility = function () {\n    var visible = this.visible();\n\n    if (visible) {\n      this.canvas._canvas.style.display = 'block';\n    } else {\n      this.canvas._canvas.style.display = 'none';\n    }\n  };\n\n  Layer.prototype._setSmoothEnabled = function () {\n    this.getContext()._context.imageSmoothingEnabled = this.imageSmoothingEnabled();\n  };\n\n  Layer.prototype.getWidth = function () {\n    if (this.parent) {\n      return this.parent.width();\n    }\n  };\n\n  Layer.prototype.setWidth = function () {\n    Util_1.Util.warn('Can not change width of layer. Use \"stage.width(value)\" function instead.');\n  };\n\n  Layer.prototype.getHeight = function () {\n    if (this.parent) {\n      return this.parent.height();\n    }\n  };\n\n  Layer.prototype.setHeight = function () {\n    Util_1.Util.warn('Can not change height of layer. Use \"stage.height(value)\" function instead.');\n  };\n\n  Layer.prototype.batchDraw = function () {\n    var _this = this;\n\n    if (!this._waitingForDraw) {\n      this._waitingForDraw = true;\n      Util_1.Util.requestAnimFrame(function () {\n        _this.draw();\n\n        _this._waitingForDraw = false;\n      });\n    }\n\n    return this;\n  };\n\n  Layer.prototype.getIntersection = function (pos, selector) {\n    if (!this.isListening() || !this.isVisible()) {\n      return null;\n    }\n\n    var spiralSearchDistance = 1;\n    var continueSearch = false;\n\n    while (true) {\n      for (var i = 0; i < INTERSECTION_OFFSETS_LEN; i++) {\n        var intersectionOffset = INTERSECTION_OFFSETS[i];\n\n        var obj = this._getIntersection({\n          x: pos.x + intersectionOffset.x * spiralSearchDistance,\n          y: pos.y + intersectionOffset.y * spiralSearchDistance\n        });\n\n        var shape = obj.shape;\n\n        if (shape && selector) {\n          return shape.findAncestor(selector, true);\n        } else if (shape) {\n          return shape;\n        }\n\n        continueSearch = !!obj.antialiased;\n\n        if (!obj.antialiased) {\n          break;\n        }\n      }\n\n      if (continueSearch) {\n        spiralSearchDistance += 1;\n      } else {\n        return null;\n      }\n    }\n  };\n\n  Layer.prototype._getIntersection = function (pos) {\n    var ratio = this.hitCanvas.pixelRatio;\n    var p = this.hitCanvas.context.getImageData(Math.round(pos.x * ratio), Math.round(pos.y * ratio), 1, 1).data;\n    var p3 = p[3];\n\n    if (p3 === 255) {\n      var colorKey = Util_1.Util._rgbToHex(p[0], p[1], p[2]);\n\n      var shape = Shape_1.shapes[HASH + colorKey];\n\n      if (shape) {\n        return {\n          shape: shape\n        };\n      }\n\n      return {\n        antialiased: true\n      };\n    } else if (p3 > 0) {\n      return {\n        antialiased: true\n      };\n    }\n\n    return {};\n  };\n\n  Layer.prototype.drawScene = function (can, top) {\n    var layer = this.getLayer(),\n        canvas = can || layer && layer.getCanvas();\n\n    this._fire(BEFORE_DRAW, {\n      node: this\n    });\n\n    if (this.clearBeforeDraw()) {\n      canvas.getContext().clear();\n    }\n\n    Container_1.Container.prototype.drawScene.call(this, canvas, top);\n\n    this._fire(DRAW, {\n      node: this\n    });\n\n    return this;\n  };\n\n  Layer.prototype.drawHit = function (can, top) {\n    var layer = this.getLayer(),\n        canvas = can || layer && layer.hitCanvas;\n\n    if (layer && layer.clearBeforeDraw()) {\n      layer.getHitCanvas().getContext().clear();\n    }\n\n    Container_1.Container.prototype.drawHit.call(this, canvas, top);\n    return this;\n  };\n\n  Layer.prototype.enableHitGraph = function () {\n    this.hitGraphEnabled(true);\n    return this;\n  };\n\n  Layer.prototype.disableHitGraph = function () {\n    this.hitGraphEnabled(false);\n    return this;\n  };\n\n  Layer.prototype.setHitGraphEnabled = function (val) {\n    Util_1.Util.warn('hitGraphEnabled method is deprecated. Please use layer.listening() instead.');\n    this.listening(val);\n  };\n\n  Layer.prototype.getHitGraphEnabled = function (val) {\n    Util_1.Util.warn('hitGraphEnabled method is deprecated. Please use layer.listening() instead.');\n    return this.listening();\n  };\n\n  Layer.prototype.toggleHitCanvas = function () {\n    if (!this.parent) {\n      return;\n    }\n\n    var parent = this.parent;\n    var added = !!this.hitCanvas._canvas.parentNode;\n\n    if (added) {\n      parent.content.removeChild(this.hitCanvas._canvas);\n    } else {\n      parent.content.appendChild(this.hitCanvas._canvas);\n    }\n  };\n\n  return Layer;\n}(Container_1.Container);\n\nexports.Layer = Layer;\nLayer.prototype.nodeType = 'Layer';\n\nGlobal_1._registerNode(Layer);\n\nFactory_1.Factory.addGetterSetter(Layer, 'imageSmoothingEnabled', true);\nFactory_1.Factory.addGetterSetter(Layer, 'clearBeforeDraw', true);\nFactory_1.Factory.addGetterSetter(Layer, 'hitGraphEnabled', true, Validators_1.getBooleanValidator());\nUtil_1.Collection.mapMethods(Layer);","map":{"version":3,"sources":["/home/namina/courses/tinkoff/paint-your-face/node_modules/konva/lib/Layer.js"],"names":["__extends","extendStatics","d","b","Object","setPrototypeOf","__proto__","Array","p","prototype","hasOwnProperty","call","__","constructor","create","defineProperty","exports","value","Layer","Util_1","require","Container_1","Node_1","Factory_1","Canvas_1","Validators_1","Shape_1","Global_1","HASH","BEFORE_DRAW","DRAW","INTERSECTION_OFFSETS","x","y","INTERSECTION_OFFSETS_LEN","length","_super","config","_this","canvas","SceneCanvas","hitCanvas","HitCanvas","pixelRatio","_waitingForDraw","on","_checkVisibility","_setSmoothEnabled","createPNGStream","c","_canvas","getCanvas","getHitCanvas","getContext","clear","bounds","setZIndex","index","stage","getStage","content","removeChild","children","insertBefore","appendChild","moveToTop","Node","moveUp","moved","moveDown","moveToBottom","getLayer","remove","parentNode","Util","_isInDocument","parent","setSize","_a","width","height","_validateAdd","child","type","getType","throw","_toKonvaCanvas","getWidth","getHeight","undefined","visible","style","display","_context","imageSmoothingEnabled","setWidth","warn","setHeight","batchDraw","requestAnimFrame","draw","getIntersection","pos","selector","isListening","isVisible","spiralSearchDistance","continueSearch","i","intersectionOffset","obj","_getIntersection","shape","findAncestor","antialiased","ratio","context","getImageData","Math","round","data","p3","colorKey","_rgbToHex","shapes","drawScene","can","top","layer","_fire","node","clearBeforeDraw","Container","drawHit","enableHitGraph","hitGraphEnabled","disableHitGraph","setHitGraphEnabled","val","listening","getHitGraphEnabled","toggleHitCanvas","added","nodeType","_registerNode","Factory","addGetterSetter","getBooleanValidator","Collection","mapMethods"],"mappings":"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","sourcesContent":["\"use strict\";\nvar __extends = (this && this.__extends) || (function () {\n    var extendStatics = function (d, b) {\n        extendStatics = Object.setPrototypeOf ||\n            ({ __proto__: [] } instanceof Array && function (d, b) { d.__proto__ = b; }) ||\n            function (d, b) { for (var p in b) if (Object.prototype.hasOwnProperty.call(b, p)) d[p] = b[p]; };\n        return extendStatics(d, b);\n    };\n    return function (d, b) {\n        extendStatics(d, b);\n        function __() { this.constructor = d; }\n        d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());\n    };\n})();\nObject.defineProperty(exports, \"__esModule\", { value: true });\nexports.Layer = void 0;\nvar Util_1 = require(\"./Util\");\nvar Container_1 = require(\"./Container\");\nvar Node_1 = require(\"./Node\");\nvar Factory_1 = require(\"./Factory\");\nvar Canvas_1 = require(\"./Canvas\");\nvar Validators_1 = require(\"./Validators\");\nvar Shape_1 = require(\"./Shape\");\nvar Global_1 = require(\"./Global\");\nvar HASH = '#', BEFORE_DRAW = 'beforeDraw', DRAW = 'draw', INTERSECTION_OFFSETS = [\n    { x: 0, y: 0 },\n    { x: -1, y: -1 },\n    { x: 1, y: -1 },\n    { x: 1, y: 1 },\n    { x: -1, y: 1 },\n], INTERSECTION_OFFSETS_LEN = INTERSECTION_OFFSETS.length;\nvar Layer = (function (_super) {\n    __extends(Layer, _super);\n    function Layer(config) {\n        var _this = _super.call(this, config) || this;\n        _this.canvas = new Canvas_1.SceneCanvas();\n        _this.hitCanvas = new Canvas_1.HitCanvas({\n            pixelRatio: 1,\n        });\n        _this._waitingForDraw = false;\n        _this.on('visibleChange.konva', _this._checkVisibility);\n        _this._checkVisibility();\n        _this.on('imageSmoothingEnabledChange.konva', _this._setSmoothEnabled);\n        _this._setSmoothEnabled();\n        return _this;\n    }\n    Layer.prototype.createPNGStream = function () {\n        var c = this.canvas._canvas;\n        return c.createPNGStream();\n    };\n    Layer.prototype.getCanvas = function () {\n        return this.canvas;\n    };\n    Layer.prototype.getHitCanvas = function () {\n        return this.hitCanvas;\n    };\n    Layer.prototype.getContext = function () {\n        return this.getCanvas().getContext();\n    };\n    Layer.prototype.clear = function (bounds) {\n        this.getContext().clear(bounds);\n        this.getHitCanvas().getContext().clear(bounds);\n        return this;\n    };\n    Layer.prototype.setZIndex = function (index) {\n        _super.prototype.setZIndex.call(this, index);\n        var stage = this.getStage();\n        if (stage) {\n            stage.content.removeChild(this.getCanvas()._canvas);\n            if (index < stage.children.length - 1) {\n                stage.content.insertBefore(this.getCanvas()._canvas, stage.children[index + 1].getCanvas()._canvas);\n            }\n            else {\n                stage.content.appendChild(this.getCanvas()._canvas);\n            }\n        }\n        return this;\n    };\n    Layer.prototype.moveToTop = function () {\n        Node_1.Node.prototype.moveToTop.call(this);\n        var stage = this.getStage();\n        if (stage) {\n            stage.content.removeChild(this.getCanvas()._canvas);\n            stage.content.appendChild(this.getCanvas()._canvas);\n        }\n        return true;\n    };\n    Layer.prototype.moveUp = function () {\n        var moved = Node_1.Node.prototype.moveUp.call(this);\n        if (!moved) {\n            return false;\n        }\n        var stage = this.getStage();\n        if (!stage) {\n            return false;\n        }\n        stage.content.removeChild(this.getCanvas()._canvas);\n        if (this.index < stage.children.length - 1) {\n            stage.content.insertBefore(this.getCanvas()._canvas, stage.children[this.index + 1].getCanvas()._canvas);\n        }\n        else {\n            stage.content.appendChild(this.getCanvas()._canvas);\n        }\n        return true;\n    };\n    Layer.prototype.moveDown = function () {\n        if (Node_1.Node.prototype.moveDown.call(this)) {\n            var stage = this.getStage();\n            if (stage) {\n                var children = stage.children;\n                stage.content.removeChild(this.getCanvas()._canvas);\n                stage.content.insertBefore(this.getCanvas()._canvas, children[this.index + 1].getCanvas()._canvas);\n            }\n            return true;\n        }\n        return false;\n    };\n    Layer.prototype.moveToBottom = function () {\n        if (Node_1.Node.prototype.moveToBottom.call(this)) {\n            var stage = this.getStage();\n            if (stage) {\n                var children = stage.children;\n                stage.content.removeChild(this.getCanvas()._canvas);\n                stage.content.insertBefore(this.getCanvas()._canvas, children[1].getCanvas()._canvas);\n            }\n            return true;\n        }\n        return false;\n    };\n    Layer.prototype.getLayer = function () {\n        return this;\n    };\n    Layer.prototype.remove = function () {\n        var _canvas = this.getCanvas()._canvas;\n        Node_1.Node.prototype.remove.call(this);\n        if (_canvas && _canvas.parentNode && Util_1.Util._isInDocument(_canvas)) {\n            _canvas.parentNode.removeChild(_canvas);\n        }\n        return this;\n    };\n    Layer.prototype.getStage = function () {\n        return this.parent;\n    };\n    Layer.prototype.setSize = function (_a) {\n        var width = _a.width, height = _a.height;\n        this.canvas.setSize(width, height);\n        this.hitCanvas.setSize(width, height);\n        this._setSmoothEnabled();\n        return this;\n    };\n    Layer.prototype._validateAdd = function (child) {\n        var type = child.getType();\n        if (type !== 'Group' && type !== 'Shape') {\n            Util_1.Util.throw('You may only add groups and shapes to a layer.');\n        }\n    };\n    Layer.prototype._toKonvaCanvas = function (config) {\n        config = config || {};\n        config.width = config.width || this.getWidth();\n        config.height = config.height || this.getHeight();\n        config.x = config.x !== undefined ? config.x : this.x();\n        config.y = config.y !== undefined ? config.y : this.y();\n        return Node_1.Node.prototype._toKonvaCanvas.call(this, config);\n    };\n    Layer.prototype._checkVisibility = function () {\n        var visible = this.visible();\n        if (visible) {\n            this.canvas._canvas.style.display = 'block';\n        }\n        else {\n            this.canvas._canvas.style.display = 'none';\n        }\n    };\n    Layer.prototype._setSmoothEnabled = function () {\n        this.getContext()._context.imageSmoothingEnabled = this.imageSmoothingEnabled();\n    };\n    Layer.prototype.getWidth = function () {\n        if (this.parent) {\n            return this.parent.width();\n        }\n    };\n    Layer.prototype.setWidth = function () {\n        Util_1.Util.warn('Can not change width of layer. Use \"stage.width(value)\" function instead.');\n    };\n    Layer.prototype.getHeight = function () {\n        if (this.parent) {\n            return this.parent.height();\n        }\n    };\n    Layer.prototype.setHeight = function () {\n        Util_1.Util.warn('Can not change height of layer. Use \"stage.height(value)\" function instead.');\n    };\n    Layer.prototype.batchDraw = function () {\n        var _this = this;\n        if (!this._waitingForDraw) {\n            this._waitingForDraw = true;\n            Util_1.Util.requestAnimFrame(function () {\n                _this.draw();\n                _this._waitingForDraw = false;\n            });\n        }\n        return this;\n    };\n    Layer.prototype.getIntersection = function (pos, selector) {\n        if (!this.isListening() || !this.isVisible()) {\n            return null;\n        }\n        var spiralSearchDistance = 1;\n        var continueSearch = false;\n        while (true) {\n            for (var i = 0; i < INTERSECTION_OFFSETS_LEN; i++) {\n                var intersectionOffset = INTERSECTION_OFFSETS[i];\n                var obj = this._getIntersection({\n                    x: pos.x + intersectionOffset.x * spiralSearchDistance,\n                    y: pos.y + intersectionOffset.y * spiralSearchDistance,\n                });\n                var shape = obj.shape;\n                if (shape && selector) {\n                    return shape.findAncestor(selector, true);\n                }\n                else if (shape) {\n                    return shape;\n                }\n                continueSearch = !!obj.antialiased;\n                if (!obj.antialiased) {\n                    break;\n                }\n            }\n            if (continueSearch) {\n                spiralSearchDistance += 1;\n            }\n            else {\n                return null;\n            }\n        }\n    };\n    Layer.prototype._getIntersection = function (pos) {\n        var ratio = this.hitCanvas.pixelRatio;\n        var p = this.hitCanvas.context.getImageData(Math.round(pos.x * ratio), Math.round(pos.y * ratio), 1, 1).data;\n        var p3 = p[3];\n        if (p3 === 255) {\n            var colorKey = Util_1.Util._rgbToHex(p[0], p[1], p[2]);\n            var shape = Shape_1.shapes[HASH + colorKey];\n            if (shape) {\n                return {\n                    shape: shape,\n                };\n            }\n            return {\n                antialiased: true,\n            };\n        }\n        else if (p3 > 0) {\n            return {\n                antialiased: true,\n            };\n        }\n        return {};\n    };\n    Layer.prototype.drawScene = function (can, top) {\n        var layer = this.getLayer(), canvas = can || (layer && layer.getCanvas());\n        this._fire(BEFORE_DRAW, {\n            node: this,\n        });\n        if (this.clearBeforeDraw()) {\n            canvas.getContext().clear();\n        }\n        Container_1.Container.prototype.drawScene.call(this, canvas, top);\n        this._fire(DRAW, {\n            node: this,\n        });\n        return this;\n    };\n    Layer.prototype.drawHit = function (can, top) {\n        var layer = this.getLayer(), canvas = can || (layer && layer.hitCanvas);\n        if (layer && layer.clearBeforeDraw()) {\n            layer.getHitCanvas().getContext().clear();\n        }\n        Container_1.Container.prototype.drawHit.call(this, canvas, top);\n        return this;\n    };\n    Layer.prototype.enableHitGraph = function () {\n        this.hitGraphEnabled(true);\n        return this;\n    };\n    Layer.prototype.disableHitGraph = function () {\n        this.hitGraphEnabled(false);\n        return this;\n    };\n    Layer.prototype.setHitGraphEnabled = function (val) {\n        Util_1.Util.warn('hitGraphEnabled method is deprecated. Please use layer.listening() instead.');\n        this.listening(val);\n    };\n    Layer.prototype.getHitGraphEnabled = function (val) {\n        Util_1.Util.warn('hitGraphEnabled method is deprecated. Please use layer.listening() instead.');\n        return this.listening();\n    };\n    Layer.prototype.toggleHitCanvas = function () {\n        if (!this.parent) {\n            return;\n        }\n        var parent = this.parent;\n        var added = !!this.hitCanvas._canvas.parentNode;\n        if (added) {\n            parent.content.removeChild(this.hitCanvas._canvas);\n        }\n        else {\n            parent.content.appendChild(this.hitCanvas._canvas);\n        }\n    };\n    return Layer;\n}(Container_1.Container));\nexports.Layer = Layer;\nLayer.prototype.nodeType = 'Layer';\nGlobal_1._registerNode(Layer);\nFactory_1.Factory.addGetterSetter(Layer, 'imageSmoothingEnabled', true);\nFactory_1.Factory.addGetterSetter(Layer, 'clearBeforeDraw', true);\nFactory_1.Factory.addGetterSetter(Layer, 'hitGraphEnabled', true, Validators_1.getBooleanValidator());\nUtil_1.Collection.mapMethods(Layer);\n"]},"metadata":{},"sourceType":"script"}