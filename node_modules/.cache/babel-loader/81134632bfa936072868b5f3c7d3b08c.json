{"ast":null,"code":"\"use strict\";\n\nvar __extends = this && this.__extends || function () {\n  var extendStatics = function (d, b) {\n    extendStatics = Object.setPrototypeOf || {\n      __proto__: []\n    } instanceof Array && function (d, b) {\n      d.__proto__ = b;\n    } || function (d, b) {\n      for (var p in b) if (Object.prototype.hasOwnProperty.call(b, p)) d[p] = b[p];\n    };\n\n    return extendStatics(d, b);\n  };\n\n  return function (d, b) {\n    extendStatics(d, b);\n\n    function __() {\n      this.constructor = d;\n    }\n\n    d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());\n  };\n}();\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.Shape = exports.shapes = void 0;\n\nvar Util_1 = require(\"./Util\");\n\nvar Factory_1 = require(\"./Factory\");\n\nvar Node_1 = require(\"./Node\");\n\nvar Validators_1 = require(\"./Validators\");\n\nvar Global_1 = require(\"./Global\");\n\nvar PointerEvents = require(\"./PointerEvents\");\n\nvar HAS_SHADOW = 'hasShadow';\nvar SHADOW_RGBA = 'shadowRGBA';\nvar patternImage = 'patternImage';\nvar linearGradient = 'linearGradient';\nvar radialGradient = 'radialGradient';\nvar dummyContext;\n\nfunction getDummyContext() {\n  if (dummyContext) {\n    return dummyContext;\n  }\n\n  dummyContext = Util_1.Util.createCanvasElement().getContext('2d');\n  return dummyContext;\n}\n\nexports.shapes = {};\n\nfunction _fillFunc(context) {\n  context.fill();\n}\n\nfunction _strokeFunc(context) {\n  context.stroke();\n}\n\nfunction _fillFuncHit(context) {\n  context.fill();\n}\n\nfunction _strokeFuncHit(context) {\n  context.stroke();\n}\n\nfunction _clearHasShadowCache() {\n  this._clearCache(HAS_SHADOW);\n}\n\nfunction _clearGetShadowRGBACache() {\n  this._clearCache(SHADOW_RGBA);\n}\n\nfunction _clearFillPatternCache() {\n  this._clearCache(patternImage);\n}\n\nfunction _clearLinearGradientCache() {\n  this._clearCache(linearGradient);\n}\n\nfunction _clearRadialGradientCache() {\n  this._clearCache(radialGradient);\n}\n\nvar Shape = function (_super) {\n  __extends(Shape, _super);\n\n  function Shape(config) {\n    var _this = _super.call(this, config) || this;\n\n    var key;\n\n    while (true) {\n      key = Util_1.Util.getRandomColor();\n\n      if (key && !(key in exports.shapes)) {\n        break;\n      }\n    }\n\n    _this.colorKey = key;\n    exports.shapes[key] = _this;\n    return _this;\n  }\n\n  Shape.prototype.getContext = function () {\n    return this.getLayer().getContext();\n  };\n\n  Shape.prototype.getCanvas = function () {\n    return this.getLayer().getCanvas();\n  };\n\n  Shape.prototype.getSceneFunc = function () {\n    return this.attrs.sceneFunc || this['_sceneFunc'];\n  };\n\n  Shape.prototype.getHitFunc = function () {\n    return this.attrs.hitFunc || this['_hitFunc'];\n  };\n\n  Shape.prototype.hasShadow = function () {\n    return this._getCache(HAS_SHADOW, this._hasShadow);\n  };\n\n  Shape.prototype._hasShadow = function () {\n    return this.shadowEnabled() && this.shadowOpacity() !== 0 && !!(this.shadowColor() || this.shadowBlur() || this.shadowOffsetX() || this.shadowOffsetY());\n  };\n\n  Shape.prototype._getFillPattern = function () {\n    return this._getCache(patternImage, this.__getFillPattern);\n  };\n\n  Shape.prototype.__getFillPattern = function () {\n    if (this.fillPatternImage()) {\n      var ctx = getDummyContext();\n      var pattern = ctx.createPattern(this.fillPatternImage(), this.fillPatternRepeat() || 'repeat');\n\n      if (pattern && pattern.setTransform) {\n        pattern.setTransform({\n          a: this.fillPatternScaleX(),\n          b: 0,\n          c: 0,\n          d: this.fillPatternScaleY(),\n          e: 0,\n          f: 0\n        });\n      }\n\n      return pattern;\n    }\n  };\n\n  Shape.prototype._getLinearGradient = function () {\n    return this._getCache(linearGradient, this.__getLinearGradient);\n  };\n\n  Shape.prototype.__getLinearGradient = function () {\n    var colorStops = this.fillLinearGradientColorStops();\n\n    if (colorStops) {\n      var ctx = getDummyContext();\n      var start = this.fillLinearGradientStartPoint();\n      var end = this.fillLinearGradientEndPoint();\n      var grd = ctx.createLinearGradient(start.x, start.y, end.x, end.y);\n\n      for (var n = 0; n < colorStops.length; n += 2) {\n        grd.addColorStop(colorStops[n], colorStops[n + 1]);\n      }\n\n      return grd;\n    }\n  };\n\n  Shape.prototype._getRadialGradient = function () {\n    return this._getCache(radialGradient, this.__getRadialGradient);\n  };\n\n  Shape.prototype.__getRadialGradient = function () {\n    var colorStops = this.fillRadialGradientColorStops();\n\n    if (colorStops) {\n      var ctx = getDummyContext();\n      var start = this.fillRadialGradientStartPoint();\n      var end = this.fillRadialGradientEndPoint();\n      var grd = ctx.createRadialGradient(start.x, start.y, this.fillRadialGradientStartRadius(), end.x, end.y, this.fillRadialGradientEndRadius());\n\n      for (var n = 0; n < colorStops.length; n += 2) {\n        grd.addColorStop(colorStops[n], colorStops[n + 1]);\n      }\n\n      return grd;\n    }\n  };\n\n  Shape.prototype.getShadowRGBA = function () {\n    return this._getCache(SHADOW_RGBA, this._getShadowRGBA);\n  };\n\n  Shape.prototype._getShadowRGBA = function () {\n    if (this.hasShadow()) {\n      var rgba = Util_1.Util.colorToRGBA(this.shadowColor());\n      return 'rgba(' + rgba.r + ',' + rgba.g + ',' + rgba.b + ',' + rgba.a * (this.shadowOpacity() || 1) + ')';\n    }\n  };\n\n  Shape.prototype.hasFill = function () {\n    var _this = this;\n\n    return this._calculate('hasFill', ['fillEnabled', 'fill', 'fillPatternImage', 'fillLinearGradientColorStops', 'fillRadialGradientColorStops'], function () {\n      return _this.fillEnabled() && !!(_this.fill() || _this.fillPatternImage() || _this.fillLinearGradientColorStops() || _this.fillRadialGradientColorStops());\n    });\n  };\n\n  Shape.prototype.hasStroke = function () {\n    var _this = this;\n\n    return this._calculate('hasStroke', ['strokeEnabled', 'strokeWidth', 'stroke', 'strokeLinearGradientColorStops'], function () {\n      return _this.strokeEnabled() && _this.strokeWidth() && !!(_this.stroke() || _this.strokeLinearGradientColorStops());\n    });\n  };\n\n  Shape.prototype.hasHitStroke = function () {\n    var width = this.hitStrokeWidth();\n\n    if (width === 'auto') {\n      return this.hasStroke();\n    }\n\n    return this.strokeEnabled() && !!width;\n  };\n\n  Shape.prototype.intersects = function (point) {\n    var stage = this.getStage(),\n        bufferHitCanvas = stage.bufferHitCanvas,\n        p;\n    bufferHitCanvas.getContext().clear();\n    this.drawHit(bufferHitCanvas, null, true);\n    p = bufferHitCanvas.context.getImageData(Math.round(point.x), Math.round(point.y), 1, 1).data;\n    return p[3] > 0;\n  };\n\n  Shape.prototype.destroy = function () {\n    Node_1.Node.prototype.destroy.call(this);\n    delete exports.shapes[this.colorKey];\n    delete this.colorKey;\n    return this;\n  };\n\n  Shape.prototype._useBufferCanvas = function (forceFill) {\n    var _a;\n\n    if (!this.getStage()) {\n      return false;\n    }\n\n    var perfectDrawEnabled = (_a = this.attrs.perfectDrawEnabled) !== null && _a !== void 0 ? _a : true;\n\n    if (!perfectDrawEnabled) {\n      return false;\n    }\n\n    var hasFill = forceFill || this.hasFill();\n    var hasStroke = this.hasStroke();\n    var isTransparent = this.getAbsoluteOpacity() !== 1;\n\n    if (hasFill && hasStroke && isTransparent) {\n      return true;\n    }\n\n    var hasShadow = this.hasShadow();\n    var strokeForShadow = this.shadowForStrokeEnabled();\n\n    if (hasFill && hasStroke && hasShadow && strokeForShadow) {\n      return true;\n    }\n\n    return false;\n  };\n\n  Shape.prototype.setStrokeHitEnabled = function (val) {\n    Util_1.Util.warn('strokeHitEnabled property is deprecated. Please use hitStrokeWidth instead.');\n\n    if (val) {\n      this.hitStrokeWidth('auto');\n    } else {\n      this.hitStrokeWidth(0);\n    }\n  };\n\n  Shape.prototype.getStrokeHitEnabled = function () {\n    if (this.hitStrokeWidth() === 0) {\n      return false;\n    } else {\n      return true;\n    }\n  };\n\n  Shape.prototype.getSelfRect = function () {\n    var size = this.size();\n    return {\n      x: this._centroid ? -size.width / 2 : 0,\n      y: this._centroid ? -size.height / 2 : 0,\n      width: size.width,\n      height: size.height\n    };\n  };\n\n  Shape.prototype.getClientRect = function (config) {\n    if (config === void 0) {\n      config = {};\n    }\n\n    var skipTransform = config.skipTransform;\n    var relativeTo = config.relativeTo;\n    var fillRect = this.getSelfRect();\n    var applyStroke = !config.skipStroke && this.hasStroke();\n    var strokeWidth = applyStroke && this.strokeWidth() || 0;\n    var fillAndStrokeWidth = fillRect.width + strokeWidth;\n    var fillAndStrokeHeight = fillRect.height + strokeWidth;\n    var applyShadow = !config.skipShadow && this.hasShadow();\n    var shadowOffsetX = applyShadow ? this.shadowOffsetX() : 0;\n    var shadowOffsetY = applyShadow ? this.shadowOffsetY() : 0;\n    var preWidth = fillAndStrokeWidth + Math.abs(shadowOffsetX);\n    var preHeight = fillAndStrokeHeight + Math.abs(shadowOffsetY);\n    var blurRadius = applyShadow && this.shadowBlur() || 0;\n    var width = preWidth + blurRadius * 2;\n    var height = preHeight + blurRadius * 2;\n    var roundingOffset = 0;\n\n    if (Math.round(strokeWidth / 2) !== strokeWidth / 2) {\n      roundingOffset = 1;\n    }\n\n    var rect = {\n      width: width + roundingOffset,\n      height: height + roundingOffset,\n      x: -Math.round(strokeWidth / 2 + blurRadius) + Math.min(shadowOffsetX, 0) + fillRect.x,\n      y: -Math.round(strokeWidth / 2 + blurRadius) + Math.min(shadowOffsetY, 0) + fillRect.y\n    };\n\n    if (!skipTransform) {\n      return this._transformedRect(rect, relativeTo);\n    }\n\n    return rect;\n  };\n\n  Shape.prototype.drawScene = function (can, top) {\n    var layer = this.getLayer(),\n        canvas = can || layer.getCanvas(),\n        context = canvas.getContext(),\n        cachedCanvas = this._getCanvasCache(),\n        drawFunc = this.getSceneFunc(),\n        hasShadow = this.hasShadow(),\n        stage,\n        bufferCanvas,\n        bufferContext;\n\n    var caching = canvas.isCache;\n    var skipBuffer = canvas.isCache;\n    var cachingSelf = top === this;\n\n    if (!this.isVisible() && !caching) {\n      return this;\n    }\n\n    if (cachedCanvas) {\n      context.save();\n      var m = this.getAbsoluteTransform(top).getMatrix();\n      context.transform(m[0], m[1], m[2], m[3], m[4], m[5]);\n\n      this._drawCachedSceneCanvas(context);\n\n      context.restore();\n      return this;\n    }\n\n    if (!drawFunc) {\n      return this;\n    }\n\n    context.save();\n\n    if (this._useBufferCanvas() && !skipBuffer) {\n      stage = this.getStage();\n      bufferCanvas = stage.bufferCanvas;\n      bufferContext = bufferCanvas.getContext();\n      bufferContext.clear();\n      bufferContext.save();\n\n      bufferContext._applyLineJoin(this);\n\n      var o = this.getAbsoluteTransform(top).getMatrix();\n      bufferContext.transform(o[0], o[1], o[2], o[3], o[4], o[5]);\n      drawFunc.call(this, bufferContext, this);\n      bufferContext.restore();\n      var ratio = bufferCanvas.pixelRatio;\n\n      if (hasShadow) {\n        context._applyShadow(this);\n      }\n\n      context._applyOpacity(this);\n\n      context._applyGlobalCompositeOperation(this);\n\n      context.drawImage(bufferCanvas._canvas, 0, 0, bufferCanvas.width / ratio, bufferCanvas.height / ratio);\n    } else {\n      context._applyLineJoin(this);\n\n      if (!cachingSelf) {\n        var o = this.getAbsoluteTransform(top).getMatrix();\n        context.transform(o[0], o[1], o[2], o[3], o[4], o[5]);\n\n        context._applyOpacity(this);\n\n        context._applyGlobalCompositeOperation(this);\n      }\n\n      if (hasShadow) {\n        context._applyShadow(this);\n      }\n\n      drawFunc.call(this, context, this);\n    }\n\n    context.restore();\n    return this;\n  };\n\n  Shape.prototype.drawHit = function (can, top, skipDragCheck) {\n    if (skipDragCheck === void 0) {\n      skipDragCheck = false;\n    }\n\n    if (!this.shouldDrawHit(top, skipDragCheck)) {\n      return this;\n    }\n\n    var layer = this.getLayer(),\n        canvas = can || layer.hitCanvas,\n        context = canvas && canvas.getContext(),\n        drawFunc = this.hitFunc() || this.sceneFunc(),\n        cachedCanvas = this._getCanvasCache(),\n        cachedHitCanvas = cachedCanvas && cachedCanvas.hit;\n\n    if (!this.colorKey) {\n      console.log(this);\n      Util_1.Util.warn('Looks like your canvas has a destroyed shape in it. Do not reuse shape after you destroyed it. See the shape in logs above. If you want to reuse shape you should call remove() instead of destroy()');\n    }\n\n    if (cachedHitCanvas) {\n      context.save();\n      var m = this.getAbsoluteTransform(top).getMatrix();\n      context.transform(m[0], m[1], m[2], m[3], m[4], m[5]);\n\n      this._drawCachedHitCanvas(context);\n\n      context.restore();\n      return this;\n    }\n\n    if (!drawFunc) {\n      return this;\n    }\n\n    context.save();\n\n    context._applyLineJoin(this);\n\n    var selfCache = this === top;\n\n    if (!selfCache) {\n      var o = this.getAbsoluteTransform(top).getMatrix();\n      context.transform(o[0], o[1], o[2], o[3], o[4], o[5]);\n    }\n\n    drawFunc.call(this, context, this);\n    context.restore();\n    return this;\n  };\n\n  Shape.prototype.drawHitFromCache = function (alphaThreshold) {\n    if (alphaThreshold === void 0) {\n      alphaThreshold = 0;\n    }\n\n    var cachedCanvas = this._getCanvasCache(),\n        sceneCanvas = this._getCachedSceneCanvas(),\n        hitCanvas = cachedCanvas.hit,\n        hitContext = hitCanvas.getContext(),\n        hitWidth = hitCanvas.getWidth(),\n        hitHeight = hitCanvas.getHeight(),\n        hitImageData,\n        hitData,\n        len,\n        rgbColorKey,\n        i,\n        alpha;\n\n    hitContext.clear();\n    hitContext.drawImage(sceneCanvas._canvas, 0, 0, hitWidth, hitHeight);\n\n    try {\n      hitImageData = hitContext.getImageData(0, 0, hitWidth, hitHeight);\n      hitData = hitImageData.data;\n      len = hitData.length;\n      rgbColorKey = Util_1.Util._hexToRgb(this.colorKey);\n\n      for (i = 0; i < len; i += 4) {\n        alpha = hitData[i + 3];\n\n        if (alpha > alphaThreshold) {\n          hitData[i] = rgbColorKey.r;\n          hitData[i + 1] = rgbColorKey.g;\n          hitData[i + 2] = rgbColorKey.b;\n          hitData[i + 3] = 255;\n        } else {\n          hitData[i + 3] = 0;\n        }\n      }\n\n      hitContext.putImageData(hitImageData, 0, 0);\n    } catch (e) {\n      Util_1.Util.error('Unable to draw hit graph from cached scene canvas. ' + e.message);\n    }\n\n    return this;\n  };\n\n  Shape.prototype.hasPointerCapture = function (pointerId) {\n    return PointerEvents.hasPointerCapture(pointerId, this);\n  };\n\n  Shape.prototype.setPointerCapture = function (pointerId) {\n    PointerEvents.setPointerCapture(pointerId, this);\n  };\n\n  Shape.prototype.releaseCapture = function (pointerId) {\n    PointerEvents.releaseCapture(pointerId, this);\n  };\n\n  return Shape;\n}(Node_1.Node);\n\nexports.Shape = Shape;\nShape.prototype._fillFunc = _fillFunc;\nShape.prototype._strokeFunc = _strokeFunc;\nShape.prototype._fillFuncHit = _fillFuncHit;\nShape.prototype._strokeFuncHit = _strokeFuncHit;\nShape.prototype._centroid = false;\nShape.prototype.nodeType = 'Shape';\n\nGlobal_1._registerNode(Shape);\n\nShape.prototype.eventListeners = {};\nShape.prototype.on.call(Shape.prototype, 'shadowColorChange.konva shadowBlurChange.konva shadowOffsetChange.konva shadowOpacityChange.konva shadowEnabledChange.konva', _clearHasShadowCache);\nShape.prototype.on.call(Shape.prototype, 'shadowColorChange.konva shadowOpacityChange.konva shadowEnabledChange.konva', _clearGetShadowRGBACache);\nShape.prototype.on.call(Shape.prototype, 'fillPriorityChange.konva fillPatternImageChange.konva fillPatternRepeatChange.konva fillPatternScaleXChange.konva fillPatternScaleYChange.konva', _clearFillPatternCache);\nShape.prototype.on.call(Shape.prototype, 'fillPriorityChange.konva fillLinearGradientColorStopsChange.konva fillLinearGradientStartPointXChange.konva fillLinearGradientStartPointYChange.konva fillLinearGradientEndPointXChange.konva fillLinearGradientEndPointYChange.konva', _clearLinearGradientCache);\nShape.prototype.on.call(Shape.prototype, 'fillPriorityChange.konva fillRadialGradientColorStopsChange.konva fillRadialGradientStartPointXChange.konva fillRadialGradientStartPointYChange.konva fillRadialGradientEndPointXChange.konva fillRadialGradientEndPointYChange.konva fillRadialGradientStartRadiusChange.konva fillRadialGradientEndRadiusChange.konva', _clearRadialGradientCache);\nFactory_1.Factory.addGetterSetter(Shape, 'stroke', undefined, Validators_1.getStringOrGradientValidator());\nFactory_1.Factory.addGetterSetter(Shape, 'strokeWidth', 2, Validators_1.getNumberValidator());\nFactory_1.Factory.addGetterSetter(Shape, 'fillAfterStrokeEnabled', false);\nFactory_1.Factory.addGetterSetter(Shape, 'hitStrokeWidth', 'auto', Validators_1.getNumberOrAutoValidator());\nFactory_1.Factory.addGetterSetter(Shape, 'strokeHitEnabled', true, Validators_1.getBooleanValidator());\nFactory_1.Factory.addGetterSetter(Shape, 'perfectDrawEnabled', true, Validators_1.getBooleanValidator());\nFactory_1.Factory.addGetterSetter(Shape, 'shadowForStrokeEnabled', true, Validators_1.getBooleanValidator());\nFactory_1.Factory.addGetterSetter(Shape, 'lineJoin');\nFactory_1.Factory.addGetterSetter(Shape, 'lineCap');\nFactory_1.Factory.addGetterSetter(Shape, 'sceneFunc');\nFactory_1.Factory.addGetterSetter(Shape, 'hitFunc');\nFactory_1.Factory.addGetterSetter(Shape, 'dash');\nFactory_1.Factory.addGetterSetter(Shape, 'dashOffset', 0, Validators_1.getNumberValidator());\nFactory_1.Factory.addGetterSetter(Shape, 'shadowColor', undefined, Validators_1.getStringValidator());\nFactory_1.Factory.addGetterSetter(Shape, 'shadowBlur', 0, Validators_1.getNumberValidator());\nFactory_1.Factory.addGetterSetter(Shape, 'shadowOpacity', 1, Validators_1.getNumberValidator());\nFactory_1.Factory.addComponentsGetterSetter(Shape, 'shadowOffset', ['x', 'y']);\nFactory_1.Factory.addGetterSetter(Shape, 'shadowOffsetX', 0, Validators_1.getNumberValidator());\nFactory_1.Factory.addGetterSetter(Shape, 'shadowOffsetY', 0, Validators_1.getNumberValidator());\nFactory_1.Factory.addGetterSetter(Shape, 'fillPatternImage');\nFactory_1.Factory.addGetterSetter(Shape, 'fill', undefined, Validators_1.getStringOrGradientValidator());\nFactory_1.Factory.addGetterSetter(Shape, 'fillPatternX', 0, Validators_1.getNumberValidator());\nFactory_1.Factory.addGetterSetter(Shape, 'fillPatternY', 0, Validators_1.getNumberValidator());\nFactory_1.Factory.addGetterSetter(Shape, 'fillLinearGradientColorStops');\nFactory_1.Factory.addGetterSetter(Shape, 'strokeLinearGradientColorStops');\nFactory_1.Factory.addGetterSetter(Shape, 'fillRadialGradientStartRadius', 0);\nFactory_1.Factory.addGetterSetter(Shape, 'fillRadialGradientEndRadius', 0);\nFactory_1.Factory.addGetterSetter(Shape, 'fillRadialGradientColorStops');\nFactory_1.Factory.addGetterSetter(Shape, 'fillPatternRepeat', 'repeat');\nFactory_1.Factory.addGetterSetter(Shape, 'fillEnabled', true);\nFactory_1.Factory.addGetterSetter(Shape, 'strokeEnabled', true);\nFactory_1.Factory.addGetterSetter(Shape, 'shadowEnabled', true);\nFactory_1.Factory.addGetterSetter(Shape, 'dashEnabled', true);\nFactory_1.Factory.addGetterSetter(Shape, 'strokeScaleEnabled', true);\nFactory_1.Factory.addGetterSetter(Shape, 'fillPriority', 'color');\nFactory_1.Factory.addComponentsGetterSetter(Shape, 'fillPatternOffset', ['x', 'y']);\nFactory_1.Factory.addGetterSetter(Shape, 'fillPatternOffsetX', 0, Validators_1.getNumberValidator());\nFactory_1.Factory.addGetterSetter(Shape, 'fillPatternOffsetY', 0, Validators_1.getNumberValidator());\nFactory_1.Factory.addComponentsGetterSetter(Shape, 'fillPatternScale', ['x', 'y']);\nFactory_1.Factory.addGetterSetter(Shape, 'fillPatternScaleX', 1, Validators_1.getNumberValidator());\nFactory_1.Factory.addGetterSetter(Shape, 'fillPatternScaleY', 1, Validators_1.getNumberValidator());\nFactory_1.Factory.addComponentsGetterSetter(Shape, 'fillLinearGradientStartPoint', ['x', 'y']);\nFactory_1.Factory.addComponentsGetterSetter(Shape, 'strokeLinearGradientStartPoint', ['x', 'y']);\nFactory_1.Factory.addGetterSetter(Shape, 'fillLinearGradientStartPointX', 0);\nFactory_1.Factory.addGetterSetter(Shape, 'strokeLinearGradientStartPointX', 0);\nFactory_1.Factory.addGetterSetter(Shape, 'fillLinearGradientStartPointY', 0);\nFactory_1.Factory.addGetterSetter(Shape, 'strokeLinearGradientStartPointY', 0);\nFactory_1.Factory.addComponentsGetterSetter(Shape, 'fillLinearGradientEndPoint', ['x', 'y']);\nFactory_1.Factory.addComponentsGetterSetter(Shape, 'strokeLinearGradientEndPoint', ['x', 'y']);\nFactory_1.Factory.addGetterSetter(Shape, 'fillLinearGradientEndPointX', 0);\nFactory_1.Factory.addGetterSetter(Shape, 'strokeLinearGradientEndPointX', 0);\nFactory_1.Factory.addGetterSetter(Shape, 'fillLinearGradientEndPointY', 0);\nFactory_1.Factory.addGetterSetter(Shape, 'strokeLinearGradientEndPointY', 0);\nFactory_1.Factory.addComponentsGetterSetter(Shape, 'fillRadialGradientStartPoint', ['x', 'y']);\nFactory_1.Factory.addGetterSetter(Shape, 'fillRadialGradientStartPointX', 0);\nFactory_1.Factory.addGetterSetter(Shape, 'fillRadialGradientStartPointY', 0);\nFactory_1.Factory.addComponentsGetterSetter(Shape, 'fillRadialGradientEndPoint', ['x', 'y']);\nFactory_1.Factory.addGetterSetter(Shape, 'fillRadialGradientEndPointX', 0);\nFactory_1.Factory.addGetterSetter(Shape, 'fillRadialGradientEndPointY', 0);\nFactory_1.Factory.addGetterSetter(Shape, 'fillPatternRotation', 0);\nFactory_1.Factory.backCompat(Shape, {\n  dashArray: 'dash',\n  getDashArray: 'getDash',\n  setDashArray: 'getDash',\n  drawFunc: 'sceneFunc',\n  getDrawFunc: 'getSceneFunc',\n  setDrawFunc: 'setSceneFunc',\n  drawHitFunc: 'hitFunc',\n  getDrawHitFunc: 'getHitFunc',\n  setDrawHitFunc: 'setHitFunc'\n});\nUtil_1.Collection.mapMethods(Shape);","map":{"version":3,"sources":["/home/namina/courses/tinkoff/paint-your-face/node_modules/konva/lib/Shape.js"],"names":["__extends","extendStatics","d","b","Object","setPrototypeOf","__proto__","Array","p","prototype","hasOwnProperty","call","__","constructor","create","defineProperty","exports","value","Shape","shapes","Util_1","require","Factory_1","Node_1","Validators_1","Global_1","PointerEvents","HAS_SHADOW","SHADOW_RGBA","patternImage","linearGradient","radialGradient","dummyContext","getDummyContext","Util","createCanvasElement","getContext","_fillFunc","context","fill","_strokeFunc","stroke","_fillFuncHit","_strokeFuncHit","_clearHasShadowCache","_clearCache","_clearGetShadowRGBACache","_clearFillPatternCache","_clearLinearGradientCache","_clearRadialGradientCache","_super","config","_this","key","getRandomColor","colorKey","getLayer","getCanvas","getSceneFunc","attrs","sceneFunc","getHitFunc","hitFunc","hasShadow","_getCache","_hasShadow","shadowEnabled","shadowOpacity","shadowColor","shadowBlur","shadowOffsetX","shadowOffsetY","_getFillPattern","__getFillPattern","fillPatternImage","ctx","pattern","createPattern","fillPatternRepeat","setTransform","a","fillPatternScaleX","c","fillPatternScaleY","e","f","_getLinearGradient","__getLinearGradient","colorStops","fillLinearGradientColorStops","start","fillLinearGradientStartPoint","end","fillLinearGradientEndPoint","grd","createLinearGradient","x","y","n","length","addColorStop","_getRadialGradient","__getRadialGradient","fillRadialGradientColorStops","fillRadialGradientStartPoint","fillRadialGradientEndPoint","createRadialGradient","fillRadialGradientStartRadius","fillRadialGradientEndRadius","getShadowRGBA","_getShadowRGBA","rgba","colorToRGBA","r","g","hasFill","_calculate","fillEnabled","hasStroke","strokeEnabled","strokeWidth","strokeLinearGradientColorStops","hasHitStroke","width","hitStrokeWidth","intersects","point","stage","getStage","bufferHitCanvas","clear","drawHit","getImageData","Math","round","data","destroy","Node","_useBufferCanvas","forceFill","_a","perfectDrawEnabled","isTransparent","getAbsoluteOpacity","strokeForShadow","shadowForStrokeEnabled","setStrokeHitEnabled","val","warn","getStrokeHitEnabled","getSelfRect","size","_centroid","height","getClientRect","skipTransform","relativeTo","fillRect","applyStroke","skipStroke","fillAndStrokeWidth","fillAndStrokeHeight","applyShadow","skipShadow","preWidth","abs","preHeight","blurRadius","roundingOffset","rect","min","_transformedRect","drawScene","can","top","layer","canvas","cachedCanvas","_getCanvasCache","drawFunc","bufferCanvas","bufferContext","caching","isCache","skipBuffer","cachingSelf","isVisible","save","m","getAbsoluteTransform","getMatrix","transform","_drawCachedSceneCanvas","restore","_applyLineJoin","o","ratio","pixelRatio","_applyShadow","_applyOpacity","_applyGlobalCompositeOperation","drawImage","_canvas","skipDragCheck","shouldDrawHit","hitCanvas","cachedHitCanvas","hit","console","log","_drawCachedHitCanvas","selfCache","drawHitFromCache","alphaThreshold","sceneCanvas","_getCachedSceneCanvas","hitContext","hitWidth","getWidth","hitHeight","getHeight","hitImageData","hitData","len","rgbColorKey","i","alpha","_hexToRgb","putImageData","error","message","hasPointerCapture","pointerId","setPointerCapture","releaseCapture","nodeType","_registerNode","eventListeners","on","Factory","addGetterSetter","undefined","getStringOrGradientValidator","getNumberValidator","getNumberOrAutoValidator","getBooleanValidator","getStringValidator","addComponentsGetterSetter","backCompat","dashArray","getDashArray","setDashArray","getDrawFunc","setDrawFunc","drawHitFunc","getDrawHitFunc","setDrawHitFunc","Collection","mapMethods"],"mappings":"AAAA;;AACA,IAAIA,SAAS,GAAI,QAAQ,KAAKA,SAAd,IAA6B,YAAY;AACrD,MAAIC,aAAa,GAAG,UAAUC,CAAV,EAAaC,CAAb,EAAgB;AAChCF,IAAAA,aAAa,GAAGG,MAAM,CAACC,cAAP,IACX;AAAEC,MAAAA,SAAS,EAAE;AAAb,iBAA6BC,KAA7B,IAAsC,UAAUL,CAAV,EAAaC,CAAb,EAAgB;AAAED,MAAAA,CAAC,CAACI,SAAF,GAAcH,CAAd;AAAkB,KAD/D,IAEZ,UAAUD,CAAV,EAAaC,CAAb,EAAgB;AAAE,WAAK,IAAIK,CAAT,IAAcL,CAAd,EAAiB,IAAIC,MAAM,CAACK,SAAP,CAAiBC,cAAjB,CAAgCC,IAAhC,CAAqCR,CAArC,EAAwCK,CAAxC,CAAJ,EAAgDN,CAAC,CAACM,CAAD,CAAD,GAAOL,CAAC,CAACK,CAAD,CAAR;AAAc,KAFrG;;AAGA,WAAOP,aAAa,CAACC,CAAD,EAAIC,CAAJ,CAApB;AACH,GALD;;AAMA,SAAO,UAAUD,CAAV,EAAaC,CAAb,EAAgB;AACnBF,IAAAA,aAAa,CAACC,CAAD,EAAIC,CAAJ,CAAb;;AACA,aAASS,EAAT,GAAc;AAAE,WAAKC,WAAL,GAAmBX,CAAnB;AAAuB;;AACvCA,IAAAA,CAAC,CAACO,SAAF,GAAcN,CAAC,KAAK,IAAN,GAAaC,MAAM,CAACU,MAAP,CAAcX,CAAd,CAAb,IAAiCS,EAAE,CAACH,SAAH,GAAeN,CAAC,CAACM,SAAjB,EAA4B,IAAIG,EAAJ,EAA7D,CAAd;AACH,GAJD;AAKH,CAZ2C,EAA5C;;AAaAR,MAAM,CAACW,cAAP,CAAsBC,OAAtB,EAA+B,YAA/B,EAA6C;AAAEC,EAAAA,KAAK,EAAE;AAAT,CAA7C;AACAD,OAAO,CAACE,KAAR,GAAgBF,OAAO,CAACG,MAAR,GAAiB,KAAK,CAAtC;;AACA,IAAIC,MAAM,GAAGC,OAAO,CAAC,QAAD,CAApB;;AACA,IAAIC,SAAS,GAAGD,OAAO,CAAC,WAAD,CAAvB;;AACA,IAAIE,MAAM,GAAGF,OAAO,CAAC,QAAD,CAApB;;AACA,IAAIG,YAAY,GAAGH,OAAO,CAAC,cAAD,CAA1B;;AACA,IAAII,QAAQ,GAAGJ,OAAO,CAAC,UAAD,CAAtB;;AACA,IAAIK,aAAa,GAAGL,OAAO,CAAC,iBAAD,CAA3B;;AACA,IAAIM,UAAU,GAAG,WAAjB;AACA,IAAIC,WAAW,GAAG,YAAlB;AACA,IAAIC,YAAY,GAAG,cAAnB;AACA,IAAIC,cAAc,GAAG,gBAArB;AACA,IAAIC,cAAc,GAAG,gBAArB;AACA,IAAIC,YAAJ;;AACA,SAASC,eAAT,GAA2B;AACvB,MAAID,YAAJ,EAAkB;AACd,WAAOA,YAAP;AACH;;AACDA,EAAAA,YAAY,GAAGZ,MAAM,CAACc,IAAP,CAAYC,mBAAZ,GAAkCC,UAAlC,CAA6C,IAA7C,CAAf;AACA,SAAOJ,YAAP;AACH;;AACDhB,OAAO,CAACG,MAAR,GAAiB,EAAjB;;AACA,SAASkB,SAAT,CAAmBC,OAAnB,EAA4B;AACxBA,EAAAA,OAAO,CAACC,IAAR;AACH;;AACD,SAASC,WAAT,CAAqBF,OAArB,EAA8B;AAC1BA,EAAAA,OAAO,CAACG,MAAR;AACH;;AACD,SAASC,YAAT,CAAsBJ,OAAtB,EAA+B;AAC3BA,EAAAA,OAAO,CAACC,IAAR;AACH;;AACD,SAASI,cAAT,CAAwBL,OAAxB,EAAiC;AAC7BA,EAAAA,OAAO,CAACG,MAAR;AACH;;AACD,SAASG,oBAAT,GAAgC;AAC5B,OAAKC,WAAL,CAAiBlB,UAAjB;AACH;;AACD,SAASmB,wBAAT,GAAoC;AAChC,OAAKD,WAAL,CAAiBjB,WAAjB;AACH;;AACD,SAASmB,sBAAT,GAAkC;AAC9B,OAAKF,WAAL,CAAiBhB,YAAjB;AACH;;AACD,SAASmB,yBAAT,GAAqC;AACjC,OAAKH,WAAL,CAAiBf,cAAjB;AACH;;AACD,SAASmB,yBAAT,GAAqC;AACjC,OAAKJ,WAAL,CAAiBd,cAAjB;AACH;;AACD,IAAIb,KAAK,GAAI,UAAUgC,MAAV,EAAkB;AAC3BlD,EAAAA,SAAS,CAACkB,KAAD,EAAQgC,MAAR,CAAT;;AACA,WAAShC,KAAT,CAAeiC,MAAf,EAAuB;AACnB,QAAIC,KAAK,GAAGF,MAAM,CAACvC,IAAP,CAAY,IAAZ,EAAkBwC,MAAlB,KAA6B,IAAzC;;AACA,QAAIE,GAAJ;;AACA,WAAO,IAAP,EAAa;AACTA,MAAAA,GAAG,GAAGjC,MAAM,CAACc,IAAP,CAAYoB,cAAZ,EAAN;;AACA,UAAID,GAAG,IAAI,EAAEA,GAAG,IAAIrC,OAAO,CAACG,MAAjB,CAAX,EAAqC;AACjC;AACH;AACJ;;AACDiC,IAAAA,KAAK,CAACG,QAAN,GAAiBF,GAAjB;AACArC,IAAAA,OAAO,CAACG,MAAR,CAAekC,GAAf,IAAsBD,KAAtB;AACA,WAAOA,KAAP;AACH;;AACDlC,EAAAA,KAAK,CAACT,SAAN,CAAgB2B,UAAhB,GAA6B,YAAY;AACrC,WAAO,KAAKoB,QAAL,GAAgBpB,UAAhB,EAAP;AACH,GAFD;;AAGAlB,EAAAA,KAAK,CAACT,SAAN,CAAgBgD,SAAhB,GAA4B,YAAY;AACpC,WAAO,KAAKD,QAAL,GAAgBC,SAAhB,EAAP;AACH,GAFD;;AAGAvC,EAAAA,KAAK,CAACT,SAAN,CAAgBiD,YAAhB,GAA+B,YAAY;AACvC,WAAO,KAAKC,KAAL,CAAWC,SAAX,IAAwB,KAAK,YAAL,CAA/B;AACH,GAFD;;AAGA1C,EAAAA,KAAK,CAACT,SAAN,CAAgBoD,UAAhB,GAA6B,YAAY;AACrC,WAAO,KAAKF,KAAL,CAAWG,OAAX,IAAsB,KAAK,UAAL,CAA7B;AACH,GAFD;;AAGA5C,EAAAA,KAAK,CAACT,SAAN,CAAgBsD,SAAhB,GAA4B,YAAY;AACpC,WAAO,KAAKC,SAAL,CAAerC,UAAf,EAA2B,KAAKsC,UAAhC,CAAP;AACH,GAFD;;AAGA/C,EAAAA,KAAK,CAACT,SAAN,CAAgBwD,UAAhB,GAA6B,YAAY;AACrC,WAAQ,KAAKC,aAAL,MACJ,KAAKC,aAAL,OAAyB,CADrB,IAEJ,CAAC,EAAE,KAAKC,WAAL,MACC,KAAKC,UAAL,EADD,IAEC,KAAKC,aAAL,EAFD,IAGC,KAAKC,aAAL,EAHH,CAFL;AAMH,GAPD;;AAQArD,EAAAA,KAAK,CAACT,SAAN,CAAgB+D,eAAhB,GAAkC,YAAY;AAC1C,WAAO,KAAKR,SAAL,CAAenC,YAAf,EAA6B,KAAK4C,gBAAlC,CAAP;AACH,GAFD;;AAGAvD,EAAAA,KAAK,CAACT,SAAN,CAAgBgE,gBAAhB,GAAmC,YAAY;AAC3C,QAAI,KAAKC,gBAAL,EAAJ,EAA6B;AACzB,UAAIC,GAAG,GAAG1C,eAAe,EAAzB;AACA,UAAI2C,OAAO,GAAGD,GAAG,CAACE,aAAJ,CAAkB,KAAKH,gBAAL,EAAlB,EAA2C,KAAKI,iBAAL,MAA4B,QAAvE,CAAd;;AACA,UAAIF,OAAO,IAAIA,OAAO,CAACG,YAAvB,EAAqC;AACjCH,QAAAA,OAAO,CAACG,YAAR,CAAqB;AACjBC,UAAAA,CAAC,EAAE,KAAKC,iBAAL,EADc;AAEjB9E,UAAAA,CAAC,EAAE,CAFc;AAGjB+E,UAAAA,CAAC,EAAE,CAHc;AAIjBhF,UAAAA,CAAC,EAAE,KAAKiF,iBAAL,EAJc;AAKjBC,UAAAA,CAAC,EAAE,CALc;AAMjBC,UAAAA,CAAC,EAAE;AANc,SAArB;AAQH;;AACD,aAAOT,OAAP;AACH;AACJ,GAhBD;;AAiBA1D,EAAAA,KAAK,CAACT,SAAN,CAAgB6E,kBAAhB,GAAqC,YAAY;AAC7C,WAAO,KAAKtB,SAAL,CAAelC,cAAf,EAA+B,KAAKyD,mBAApC,CAAP;AACH,GAFD;;AAGArE,EAAAA,KAAK,CAACT,SAAN,CAAgB8E,mBAAhB,GAAsC,YAAY;AAC9C,QAAIC,UAAU,GAAG,KAAKC,4BAAL,EAAjB;;AACA,QAAID,UAAJ,EAAgB;AACZ,UAAIb,GAAG,GAAG1C,eAAe,EAAzB;AACA,UAAIyD,KAAK,GAAG,KAAKC,4BAAL,EAAZ;AACA,UAAIC,GAAG,GAAG,KAAKC,0BAAL,EAAV;AACA,UAAIC,GAAG,GAAGnB,GAAG,CAACoB,oBAAJ,CAAyBL,KAAK,CAACM,CAA/B,EAAkCN,KAAK,CAACO,CAAxC,EAA2CL,GAAG,CAACI,CAA/C,EAAkDJ,GAAG,CAACK,CAAtD,CAAV;;AACA,WAAK,IAAIC,CAAC,GAAG,CAAb,EAAgBA,CAAC,GAAGV,UAAU,CAACW,MAA/B,EAAuCD,CAAC,IAAI,CAA5C,EAA+C;AAC3CJ,QAAAA,GAAG,CAACM,YAAJ,CAAiBZ,UAAU,CAACU,CAAD,CAA3B,EAAgCV,UAAU,CAACU,CAAC,GAAG,CAAL,CAA1C;AACH;;AACD,aAAOJ,GAAP;AACH;AACJ,GAZD;;AAaA5E,EAAAA,KAAK,CAACT,SAAN,CAAgB4F,kBAAhB,GAAqC,YAAY;AAC7C,WAAO,KAAKrC,SAAL,CAAejC,cAAf,EAA+B,KAAKuE,mBAApC,CAAP;AACH,GAFD;;AAGApF,EAAAA,KAAK,CAACT,SAAN,CAAgB6F,mBAAhB,GAAsC,YAAY;AAC9C,QAAId,UAAU,GAAG,KAAKe,4BAAL,EAAjB;;AACA,QAAIf,UAAJ,EAAgB;AACZ,UAAIb,GAAG,GAAG1C,eAAe,EAAzB;AACA,UAAIyD,KAAK,GAAG,KAAKc,4BAAL,EAAZ;AACA,UAAIZ,GAAG,GAAG,KAAKa,0BAAL,EAAV;AACA,UAAIX,GAAG,GAAGnB,GAAG,CAAC+B,oBAAJ,CAAyBhB,KAAK,CAACM,CAA/B,EAAkCN,KAAK,CAACO,CAAxC,EAA2C,KAAKU,6BAAL,EAA3C,EAAiFf,GAAG,CAACI,CAArF,EAAwFJ,GAAG,CAACK,CAA5F,EAA+F,KAAKW,2BAAL,EAA/F,CAAV;;AACA,WAAK,IAAIV,CAAC,GAAG,CAAb,EAAgBA,CAAC,GAAGV,UAAU,CAACW,MAA/B,EAAuCD,CAAC,IAAI,CAA5C,EAA+C;AAC3CJ,QAAAA,GAAG,CAACM,YAAJ,CAAiBZ,UAAU,CAACU,CAAD,CAA3B,EAAgCV,UAAU,CAACU,CAAC,GAAG,CAAL,CAA1C;AACH;;AACD,aAAOJ,GAAP;AACH;AACJ,GAZD;;AAaA5E,EAAAA,KAAK,CAACT,SAAN,CAAgBoG,aAAhB,GAAgC,YAAY;AACxC,WAAO,KAAK7C,SAAL,CAAepC,WAAf,EAA4B,KAAKkF,cAAjC,CAAP;AACH,GAFD;;AAGA5F,EAAAA,KAAK,CAACT,SAAN,CAAgBqG,cAAhB,GAAiC,YAAY;AACzC,QAAI,KAAK/C,SAAL,EAAJ,EAAsB;AAClB,UAAIgD,IAAI,GAAG3F,MAAM,CAACc,IAAP,CAAY8E,WAAZ,CAAwB,KAAK5C,WAAL,EAAxB,CAAX;AACA,aAAQ,UACJ2C,IAAI,CAACE,CADD,GAEJ,GAFI,GAGJF,IAAI,CAACG,CAHD,GAIJ,GAJI,GAKJH,IAAI,CAAC5G,CALD,GAMJ,GANI,GAOJ4G,IAAI,CAAC/B,CAAL,IAAU,KAAKb,aAAL,MAAwB,CAAlC,CAPI,GAQJ,GARJ;AASH;AACJ,GAbD;;AAcAjD,EAAAA,KAAK,CAACT,SAAN,CAAgB0G,OAAhB,GAA0B,YAAY;AAClC,QAAI/D,KAAK,GAAG,IAAZ;;AACA,WAAO,KAAKgE,UAAL,CAAgB,SAAhB,EAA2B,CAC9B,aAD8B,EAE9B,MAF8B,EAG9B,kBAH8B,EAI9B,8BAJ8B,EAK9B,8BAL8B,CAA3B,EAMJ,YAAY;AACX,aAAQhE,KAAK,CAACiE,WAAN,MACJ,CAAC,EAAEjE,KAAK,CAACb,IAAN,MACCa,KAAK,CAACsB,gBAAN,EADD,IAECtB,KAAK,CAACqC,4BAAN,EAFD,IAGCrC,KAAK,CAACmD,4BAAN,EAHH,CADL;AAKH,KAZM,CAAP;AAaH,GAfD;;AAgBArF,EAAAA,KAAK,CAACT,SAAN,CAAgB6G,SAAhB,GAA4B,YAAY;AACpC,QAAIlE,KAAK,GAAG,IAAZ;;AACA,WAAO,KAAKgE,UAAL,CAAgB,WAAhB,EAA6B,CAChC,eADgC,EAEhC,aAFgC,EAGhC,QAHgC,EAIhC,gCAJgC,CAA7B,EAKJ,YAAY;AACX,aAAQhE,KAAK,CAACmE,aAAN,MACJnE,KAAK,CAACoE,WAAN,EADI,IAEJ,CAAC,EAAEpE,KAAK,CAACX,MAAN,MAAkBW,KAAK,CAACqE,8BAAN,EAApB,CAFL;AAGH,KATM,CAAP;AAUH,GAZD;;AAaAvG,EAAAA,KAAK,CAACT,SAAN,CAAgBiH,YAAhB,GAA+B,YAAY;AACvC,QAAIC,KAAK,GAAG,KAAKC,cAAL,EAAZ;;AACA,QAAID,KAAK,KAAK,MAAd,EAAsB;AAClB,aAAO,KAAKL,SAAL,EAAP;AACH;;AACD,WAAO,KAAKC,aAAL,MAAwB,CAAC,CAACI,KAAjC;AACH,GAND;;AAOAzG,EAAAA,KAAK,CAACT,SAAN,CAAgBoH,UAAhB,GAA6B,UAAUC,KAAV,EAAiB;AAC1C,QAAIC,KAAK,GAAG,KAAKC,QAAL,EAAZ;AAAA,QAA6BC,eAAe,GAAGF,KAAK,CAACE,eAArD;AAAA,QAAsEzH,CAAtE;AACAyH,IAAAA,eAAe,CAAC7F,UAAhB,GAA6B8F,KAA7B;AACA,SAAKC,OAAL,CAAaF,eAAb,EAA8B,IAA9B,EAAoC,IAApC;AACAzH,IAAAA,CAAC,GAAGyH,eAAe,CAAC3F,OAAhB,CAAwB8F,YAAxB,CAAqCC,IAAI,CAACC,KAAL,CAAWR,KAAK,CAAC9B,CAAjB,CAArC,EAA0DqC,IAAI,CAACC,KAAL,CAAWR,KAAK,CAAC7B,CAAjB,CAA1D,EAA+E,CAA/E,EAAkF,CAAlF,EAAqFsC,IAAzF;AACA,WAAO/H,CAAC,CAAC,CAAD,CAAD,GAAO,CAAd;AACH,GAND;;AAOAU,EAAAA,KAAK,CAACT,SAAN,CAAgB+H,OAAhB,GAA0B,YAAY;AAClCjH,IAAAA,MAAM,CAACkH,IAAP,CAAYhI,SAAZ,CAAsB+H,OAAtB,CAA8B7H,IAA9B,CAAmC,IAAnC;AACA,WAAOK,OAAO,CAACG,MAAR,CAAe,KAAKoC,QAApB,CAAP;AACA,WAAO,KAAKA,QAAZ;AACA,WAAO,IAAP;AACH,GALD;;AAMArC,EAAAA,KAAK,CAACT,SAAN,CAAgBiI,gBAAhB,GAAmC,UAAUC,SAAV,EAAqB;AACpD,QAAIC,EAAJ;;AACA,QAAI,CAAC,KAAKZ,QAAL,EAAL,EAAsB;AAClB,aAAO,KAAP;AACH;;AACD,QAAIa,kBAAkB,GAAG,CAACD,EAAE,GAAG,KAAKjF,KAAL,CAAWkF,kBAAjB,MAAyC,IAAzC,IAAiDD,EAAE,KAAK,KAAK,CAA7D,GAAiEA,EAAjE,GAAsE,IAA/F;;AACA,QAAI,CAACC,kBAAL,EAAyB;AACrB,aAAO,KAAP;AACH;;AACD,QAAI1B,OAAO,GAAGwB,SAAS,IAAI,KAAKxB,OAAL,EAA3B;AACA,QAAIG,SAAS,GAAG,KAAKA,SAAL,EAAhB;AACA,QAAIwB,aAAa,GAAG,KAAKC,kBAAL,OAA8B,CAAlD;;AACA,QAAI5B,OAAO,IAAIG,SAAX,IAAwBwB,aAA5B,EAA2C;AACvC,aAAO,IAAP;AACH;;AACD,QAAI/E,SAAS,GAAG,KAAKA,SAAL,EAAhB;AACA,QAAIiF,eAAe,GAAG,KAAKC,sBAAL,EAAtB;;AACA,QAAI9B,OAAO,IAAIG,SAAX,IAAwBvD,SAAxB,IAAqCiF,eAAzC,EAA0D;AACtD,aAAO,IAAP;AACH;;AACD,WAAO,KAAP;AACH,GArBD;;AAsBA9H,EAAAA,KAAK,CAACT,SAAN,CAAgByI,mBAAhB,GAAsC,UAAUC,GAAV,EAAe;AACjD/H,IAAAA,MAAM,CAACc,IAAP,CAAYkH,IAAZ,CAAiB,6EAAjB;;AACA,QAAID,GAAJ,EAAS;AACL,WAAKvB,cAAL,CAAoB,MAApB;AACH,KAFD,MAGK;AACD,WAAKA,cAAL,CAAoB,CAApB;AACH;AACJ,GARD;;AASA1G,EAAAA,KAAK,CAACT,SAAN,CAAgB4I,mBAAhB,GAAsC,YAAY;AAC9C,QAAI,KAAKzB,cAAL,OAA0B,CAA9B,EAAiC;AAC7B,aAAO,KAAP;AACH,KAFD,MAGK;AACD,aAAO,IAAP;AACH;AACJ,GAPD;;AAQA1G,EAAAA,KAAK,CAACT,SAAN,CAAgB6I,WAAhB,GAA8B,YAAY;AACtC,QAAIC,IAAI,GAAG,KAAKA,IAAL,EAAX;AACA,WAAO;AACHvD,MAAAA,CAAC,EAAE,KAAKwD,SAAL,GAAiB,CAACD,IAAI,CAAC5B,KAAN,GAAc,CAA/B,GAAmC,CADnC;AAEH1B,MAAAA,CAAC,EAAE,KAAKuD,SAAL,GAAiB,CAACD,IAAI,CAACE,MAAN,GAAe,CAAhC,GAAoC,CAFpC;AAGH9B,MAAAA,KAAK,EAAE4B,IAAI,CAAC5B,KAHT;AAIH8B,MAAAA,MAAM,EAAEF,IAAI,CAACE;AAJV,KAAP;AAMH,GARD;;AASAvI,EAAAA,KAAK,CAACT,SAAN,CAAgBiJ,aAAhB,GAAgC,UAAUvG,MAAV,EAAkB;AAC9C,QAAIA,MAAM,KAAK,KAAK,CAApB,EAAuB;AAAEA,MAAAA,MAAM,GAAG,EAAT;AAAc;;AACvC,QAAIwG,aAAa,GAAGxG,MAAM,CAACwG,aAA3B;AACA,QAAIC,UAAU,GAAGzG,MAAM,CAACyG,UAAxB;AACA,QAAIC,QAAQ,GAAG,KAAKP,WAAL,EAAf;AACA,QAAIQ,WAAW,GAAG,CAAC3G,MAAM,CAAC4G,UAAR,IAAsB,KAAKzC,SAAL,EAAxC;AACA,QAAIE,WAAW,GAAIsC,WAAW,IAAI,KAAKtC,WAAL,EAAhB,IAAuC,CAAzD;AACA,QAAIwC,kBAAkB,GAAGH,QAAQ,CAAClC,KAAT,GAAiBH,WAA1C;AACA,QAAIyC,mBAAmB,GAAGJ,QAAQ,CAACJ,MAAT,GAAkBjC,WAA5C;AACA,QAAI0C,WAAW,GAAG,CAAC/G,MAAM,CAACgH,UAAR,IAAsB,KAAKpG,SAAL,EAAxC;AACA,QAAIO,aAAa,GAAG4F,WAAW,GAAG,KAAK5F,aAAL,EAAH,GAA0B,CAAzD;AACA,QAAIC,aAAa,GAAG2F,WAAW,GAAG,KAAK3F,aAAL,EAAH,GAA0B,CAAzD;AACA,QAAI6F,QAAQ,GAAGJ,kBAAkB,GAAG3B,IAAI,CAACgC,GAAL,CAAS/F,aAAT,CAApC;AACA,QAAIgG,SAAS,GAAGL,mBAAmB,GAAG5B,IAAI,CAACgC,GAAL,CAAS9F,aAAT,CAAtC;AACA,QAAIgG,UAAU,GAAIL,WAAW,IAAI,KAAK7F,UAAL,EAAhB,IAAsC,CAAvD;AACA,QAAIsD,KAAK,GAAGyC,QAAQ,GAAGG,UAAU,GAAG,CAApC;AACA,QAAId,MAAM,GAAGa,SAAS,GAAGC,UAAU,GAAG,CAAtC;AACA,QAAIC,cAAc,GAAG,CAArB;;AACA,QAAInC,IAAI,CAACC,KAAL,CAAWd,WAAW,GAAG,CAAzB,MAAgCA,WAAW,GAAG,CAAlD,EAAqD;AACjDgD,MAAAA,cAAc,GAAG,CAAjB;AACH;;AACD,QAAIC,IAAI,GAAG;AACP9C,MAAAA,KAAK,EAAEA,KAAK,GAAG6C,cADR;AAEPf,MAAAA,MAAM,EAAEA,MAAM,GAAGe,cAFV;AAGPxE,MAAAA,CAAC,EAAE,CAACqC,IAAI,CAACC,KAAL,CAAWd,WAAW,GAAG,CAAd,GAAkB+C,UAA7B,CAAD,GACClC,IAAI,CAACqC,GAAL,CAASpG,aAAT,EAAwB,CAAxB,CADD,GAECuF,QAAQ,CAAC7D,CALN;AAMPC,MAAAA,CAAC,EAAE,CAACoC,IAAI,CAACC,KAAL,CAAWd,WAAW,GAAG,CAAd,GAAkB+C,UAA7B,CAAD,GACClC,IAAI,CAACqC,GAAL,CAASnG,aAAT,EAAwB,CAAxB,CADD,GAECsF,QAAQ,CAAC5D;AARN,KAAX;;AAUA,QAAI,CAAC0D,aAAL,EAAoB;AAChB,aAAO,KAAKgB,gBAAL,CAAsBF,IAAtB,EAA4Bb,UAA5B,CAAP;AACH;;AACD,WAAOa,IAAP;AACH,GAnCD;;AAoCAvJ,EAAAA,KAAK,CAACT,SAAN,CAAgBmK,SAAhB,GAA4B,UAAUC,GAAV,EAAeC,GAAf,EAAoB;AAC5C,QAAIC,KAAK,GAAG,KAAKvH,QAAL,EAAZ;AAAA,QAA6BwH,MAAM,GAAGH,GAAG,IAAIE,KAAK,CAACtH,SAAN,EAA7C;AAAA,QAAgEnB,OAAO,GAAG0I,MAAM,CAAC5I,UAAP,EAA1E;AAAA,QAA+F6I,YAAY,GAAG,KAAKC,eAAL,EAA9G;AAAA,QAAsIC,QAAQ,GAAG,KAAKzH,YAAL,EAAjJ;AAAA,QAAsKK,SAAS,GAAG,KAAKA,SAAL,EAAlL;AAAA,QAAoMgE,KAApM;AAAA,QAA2MqD,YAA3M;AAAA,QAAyNC,aAAzN;;AACA,QAAIC,OAAO,GAAGN,MAAM,CAACO,OAArB;AACA,QAAIC,UAAU,GAAGR,MAAM,CAACO,OAAxB;AACA,QAAIE,WAAW,GAAGX,GAAG,KAAK,IAA1B;;AACA,QAAI,CAAC,KAAKY,SAAL,EAAD,IAAqB,CAACJ,OAA1B,EAAmC;AAC/B,aAAO,IAAP;AACH;;AACD,QAAIL,YAAJ,EAAkB;AACd3I,MAAAA,OAAO,CAACqJ,IAAR;AACA,UAAIC,CAAC,GAAG,KAAKC,oBAAL,CAA0Bf,GAA1B,EAA+BgB,SAA/B,EAAR;AACAxJ,MAAAA,OAAO,CAACyJ,SAAR,CAAkBH,CAAC,CAAC,CAAD,CAAnB,EAAwBA,CAAC,CAAC,CAAD,CAAzB,EAA8BA,CAAC,CAAC,CAAD,CAA/B,EAAoCA,CAAC,CAAC,CAAD,CAArC,EAA0CA,CAAC,CAAC,CAAD,CAA3C,EAAgDA,CAAC,CAAC,CAAD,CAAjD;;AACA,WAAKI,sBAAL,CAA4B1J,OAA5B;;AACAA,MAAAA,OAAO,CAAC2J,OAAR;AACA,aAAO,IAAP;AACH;;AACD,QAAI,CAACd,QAAL,EAAe;AACX,aAAO,IAAP;AACH;;AACD7I,IAAAA,OAAO,CAACqJ,IAAR;;AACA,QAAI,KAAKjD,gBAAL,MAA2B,CAAC8C,UAAhC,EAA4C;AACxCzD,MAAAA,KAAK,GAAG,KAAKC,QAAL,EAAR;AACAoD,MAAAA,YAAY,GAAGrD,KAAK,CAACqD,YAArB;AACAC,MAAAA,aAAa,GAAGD,YAAY,CAAChJ,UAAb,EAAhB;AACAiJ,MAAAA,aAAa,CAACnD,KAAd;AACAmD,MAAAA,aAAa,CAACM,IAAd;;AACAN,MAAAA,aAAa,CAACa,cAAd,CAA6B,IAA7B;;AACA,UAAIC,CAAC,GAAG,KAAKN,oBAAL,CAA0Bf,GAA1B,EAA+BgB,SAA/B,EAAR;AACAT,MAAAA,aAAa,CAACU,SAAd,CAAwBI,CAAC,CAAC,CAAD,CAAzB,EAA8BA,CAAC,CAAC,CAAD,CAA/B,EAAoCA,CAAC,CAAC,CAAD,CAArC,EAA0CA,CAAC,CAAC,CAAD,CAA3C,EAAgDA,CAAC,CAAC,CAAD,CAAjD,EAAsDA,CAAC,CAAC,CAAD,CAAvD;AACAhB,MAAAA,QAAQ,CAACxK,IAAT,CAAc,IAAd,EAAoB0K,aAApB,EAAmC,IAAnC;AACAA,MAAAA,aAAa,CAACY,OAAd;AACA,UAAIG,KAAK,GAAGhB,YAAY,CAACiB,UAAzB;;AACA,UAAItI,SAAJ,EAAe;AACXzB,QAAAA,OAAO,CAACgK,YAAR,CAAqB,IAArB;AACH;;AACDhK,MAAAA,OAAO,CAACiK,aAAR,CAAsB,IAAtB;;AACAjK,MAAAA,OAAO,CAACkK,8BAAR,CAAuC,IAAvC;;AACAlK,MAAAA,OAAO,CAACmK,SAAR,CAAkBrB,YAAY,CAACsB,OAA/B,EAAwC,CAAxC,EAA2C,CAA3C,EAA8CtB,YAAY,CAACzD,KAAb,GAAqByE,KAAnE,EAA0EhB,YAAY,CAAC3B,MAAb,GAAsB2C,KAAhG;AACH,KAlBD,MAmBK;AACD9J,MAAAA,OAAO,CAAC4J,cAAR,CAAuB,IAAvB;;AACA,UAAI,CAACT,WAAL,EAAkB;AACd,YAAIU,CAAC,GAAG,KAAKN,oBAAL,CAA0Bf,GAA1B,EAA+BgB,SAA/B,EAAR;AACAxJ,QAAAA,OAAO,CAACyJ,SAAR,CAAkBI,CAAC,CAAC,CAAD,CAAnB,EAAwBA,CAAC,CAAC,CAAD,CAAzB,EAA8BA,CAAC,CAAC,CAAD,CAA/B,EAAoCA,CAAC,CAAC,CAAD,CAArC,EAA0CA,CAAC,CAAC,CAAD,CAA3C,EAAgDA,CAAC,CAAC,CAAD,CAAjD;;AACA7J,QAAAA,OAAO,CAACiK,aAAR,CAAsB,IAAtB;;AACAjK,QAAAA,OAAO,CAACkK,8BAAR,CAAuC,IAAvC;AACH;;AACD,UAAIzI,SAAJ,EAAe;AACXzB,QAAAA,OAAO,CAACgK,YAAR,CAAqB,IAArB;AACH;;AACDnB,MAAAA,QAAQ,CAACxK,IAAT,CAAc,IAAd,EAAoB2B,OAApB,EAA6B,IAA7B;AACH;;AACDA,IAAAA,OAAO,CAAC2J,OAAR;AACA,WAAO,IAAP;AACH,GAtDD;;AAuDA/K,EAAAA,KAAK,CAACT,SAAN,CAAgB0H,OAAhB,GAA0B,UAAU0C,GAAV,EAAeC,GAAf,EAAoB6B,aAApB,EAAmC;AACzD,QAAIA,aAAa,KAAK,KAAK,CAA3B,EAA8B;AAAEA,MAAAA,aAAa,GAAG,KAAhB;AAAwB;;AACxD,QAAI,CAAC,KAAKC,aAAL,CAAmB9B,GAAnB,EAAwB6B,aAAxB,CAAL,EAA6C;AACzC,aAAO,IAAP;AACH;;AACD,QAAI5B,KAAK,GAAG,KAAKvH,QAAL,EAAZ;AAAA,QAA6BwH,MAAM,GAAGH,GAAG,IAAIE,KAAK,CAAC8B,SAAnD;AAAA,QAA8DvK,OAAO,GAAG0I,MAAM,IAAIA,MAAM,CAAC5I,UAAP,EAAlF;AAAA,QAAuG+I,QAAQ,GAAG,KAAKrH,OAAL,MAAkB,KAAKF,SAAL,EAApI;AAAA,QAAsJqH,YAAY,GAAG,KAAKC,eAAL,EAArK;AAAA,QAA6L4B,eAAe,GAAG7B,YAAY,IAAIA,YAAY,CAAC8B,GAA5O;;AACA,QAAI,CAAC,KAAKxJ,QAAV,EAAoB;AAChByJ,MAAAA,OAAO,CAACC,GAAR,CAAY,IAAZ;AACA7L,MAAAA,MAAM,CAACc,IAAP,CAAYkH,IAAZ,CAAiB,sMAAjB;AACH;;AACD,QAAI0D,eAAJ,EAAqB;AACjBxK,MAAAA,OAAO,CAACqJ,IAAR;AACA,UAAIC,CAAC,GAAG,KAAKC,oBAAL,CAA0Bf,GAA1B,EAA+BgB,SAA/B,EAAR;AACAxJ,MAAAA,OAAO,CAACyJ,SAAR,CAAkBH,CAAC,CAAC,CAAD,CAAnB,EAAwBA,CAAC,CAAC,CAAD,CAAzB,EAA8BA,CAAC,CAAC,CAAD,CAA/B,EAAoCA,CAAC,CAAC,CAAD,CAArC,EAA0CA,CAAC,CAAC,CAAD,CAA3C,EAAgDA,CAAC,CAAC,CAAD,CAAjD;;AACA,WAAKsB,oBAAL,CAA0B5K,OAA1B;;AACAA,MAAAA,OAAO,CAAC2J,OAAR;AACA,aAAO,IAAP;AACH;;AACD,QAAI,CAACd,QAAL,EAAe;AACX,aAAO,IAAP;AACH;;AACD7I,IAAAA,OAAO,CAACqJ,IAAR;;AACArJ,IAAAA,OAAO,CAAC4J,cAAR,CAAuB,IAAvB;;AACA,QAAIiB,SAAS,GAAG,SAASrC,GAAzB;;AACA,QAAI,CAACqC,SAAL,EAAgB;AACZ,UAAIhB,CAAC,GAAG,KAAKN,oBAAL,CAA0Bf,GAA1B,EAA+BgB,SAA/B,EAAR;AACAxJ,MAAAA,OAAO,CAACyJ,SAAR,CAAkBI,CAAC,CAAC,CAAD,CAAnB,EAAwBA,CAAC,CAAC,CAAD,CAAzB,EAA8BA,CAAC,CAAC,CAAD,CAA/B,EAAoCA,CAAC,CAAC,CAAD,CAArC,EAA0CA,CAAC,CAAC,CAAD,CAA3C,EAAgDA,CAAC,CAAC,CAAD,CAAjD;AACH;;AACDhB,IAAAA,QAAQ,CAACxK,IAAT,CAAc,IAAd,EAAoB2B,OAApB,EAA6B,IAA7B;AACAA,IAAAA,OAAO,CAAC2J,OAAR;AACA,WAAO,IAAP;AACH,GA/BD;;AAgCA/K,EAAAA,KAAK,CAACT,SAAN,CAAgB2M,gBAAhB,GAAmC,UAAUC,cAAV,EAA0B;AACzD,QAAIA,cAAc,KAAK,KAAK,CAA5B,EAA+B;AAAEA,MAAAA,cAAc,GAAG,CAAjB;AAAqB;;AACtD,QAAIpC,YAAY,GAAG,KAAKC,eAAL,EAAnB;AAAA,QAA2CoC,WAAW,GAAG,KAAKC,qBAAL,EAAzD;AAAA,QAAuFV,SAAS,GAAG5B,YAAY,CAAC8B,GAAhH;AAAA,QAAqHS,UAAU,GAAGX,SAAS,CAACzK,UAAV,EAAlI;AAAA,QAA0JqL,QAAQ,GAAGZ,SAAS,CAACa,QAAV,EAArK;AAAA,QAA2LC,SAAS,GAAGd,SAAS,CAACe,SAAV,EAAvM;AAAA,QAA8NC,YAA9N;AAAA,QAA4OC,OAA5O;AAAA,QAAqPC,GAArP;AAAA,QAA0PC,WAA1P;AAAA,QAAuQC,CAAvQ;AAAA,QAA0QC,KAA1Q;;AACAV,IAAAA,UAAU,CAACtF,KAAX;AACAsF,IAAAA,UAAU,CAACf,SAAX,CAAqBa,WAAW,CAACZ,OAAjC,EAA0C,CAA1C,EAA6C,CAA7C,EAAgDe,QAAhD,EAA0DE,SAA1D;;AACA,QAAI;AACAE,MAAAA,YAAY,GAAGL,UAAU,CAACpF,YAAX,CAAwB,CAAxB,EAA2B,CAA3B,EAA8BqF,QAA9B,EAAwCE,SAAxC,CAAf;AACAG,MAAAA,OAAO,GAAGD,YAAY,CAACtF,IAAvB;AACAwF,MAAAA,GAAG,GAAGD,OAAO,CAAC3H,MAAd;AACA6H,MAAAA,WAAW,GAAG5M,MAAM,CAACc,IAAP,CAAYiM,SAAZ,CAAsB,KAAK5K,QAA3B,CAAd;;AACA,WAAK0K,CAAC,GAAG,CAAT,EAAYA,CAAC,GAAGF,GAAhB,EAAqBE,CAAC,IAAI,CAA1B,EAA6B;AACzBC,QAAAA,KAAK,GAAGJ,OAAO,CAACG,CAAC,GAAG,CAAL,CAAf;;AACA,YAAIC,KAAK,GAAGb,cAAZ,EAA4B;AACxBS,UAAAA,OAAO,CAACG,CAAD,CAAP,GAAaD,WAAW,CAAC/G,CAAzB;AACA6G,UAAAA,OAAO,CAACG,CAAC,GAAG,CAAL,CAAP,GAAiBD,WAAW,CAAC9G,CAA7B;AACA4G,UAAAA,OAAO,CAACG,CAAC,GAAG,CAAL,CAAP,GAAiBD,WAAW,CAAC7N,CAA7B;AACA2N,UAAAA,OAAO,CAACG,CAAC,GAAG,CAAL,CAAP,GAAiB,GAAjB;AACH,SALD,MAMK;AACDH,UAAAA,OAAO,CAACG,CAAC,GAAG,CAAL,CAAP,GAAiB,CAAjB;AACH;AACJ;;AACDT,MAAAA,UAAU,CAACY,YAAX,CAAwBP,YAAxB,EAAsC,CAAtC,EAAyC,CAAzC;AACH,KAlBD,CAmBA,OAAOzI,CAAP,EAAU;AACNhE,MAAAA,MAAM,CAACc,IAAP,CAAYmM,KAAZ,CAAkB,wDAAwDjJ,CAAC,CAACkJ,OAA5E;AACH;;AACD,WAAO,IAAP;AACH,GA5BD;;AA6BApN,EAAAA,KAAK,CAACT,SAAN,CAAgB8N,iBAAhB,GAAoC,UAAUC,SAAV,EAAqB;AACrD,WAAO9M,aAAa,CAAC6M,iBAAd,CAAgCC,SAAhC,EAA2C,IAA3C,CAAP;AACH,GAFD;;AAGAtN,EAAAA,KAAK,CAACT,SAAN,CAAgBgO,iBAAhB,GAAoC,UAAUD,SAAV,EAAqB;AACrD9M,IAAAA,aAAa,CAAC+M,iBAAd,CAAgCD,SAAhC,EAA2C,IAA3C;AACH,GAFD;;AAGAtN,EAAAA,KAAK,CAACT,SAAN,CAAgBiO,cAAhB,GAAiC,UAAUF,SAAV,EAAqB;AAClD9M,IAAAA,aAAa,CAACgN,cAAd,CAA6BF,SAA7B,EAAwC,IAAxC;AACH,GAFD;;AAGA,SAAOtN,KAAP;AACH,CA9WY,CA8WXK,MAAM,CAACkH,IA9WI,CAAb;;AA+WAzH,OAAO,CAACE,KAAR,GAAgBA,KAAhB;AACAA,KAAK,CAACT,SAAN,CAAgB4B,SAAhB,GAA4BA,SAA5B;AACAnB,KAAK,CAACT,SAAN,CAAgB+B,WAAhB,GAA8BA,WAA9B;AACAtB,KAAK,CAACT,SAAN,CAAgBiC,YAAhB,GAA+BA,YAA/B;AACAxB,KAAK,CAACT,SAAN,CAAgBkC,cAAhB,GAAiCA,cAAjC;AACAzB,KAAK,CAACT,SAAN,CAAgB+I,SAAhB,GAA4B,KAA5B;AACAtI,KAAK,CAACT,SAAN,CAAgBkO,QAAhB,GAA2B,OAA3B;;AACAlN,QAAQ,CAACmN,aAAT,CAAuB1N,KAAvB;;AACAA,KAAK,CAACT,SAAN,CAAgBoO,cAAhB,GAAiC,EAAjC;AACA3N,KAAK,CAACT,SAAN,CAAgBqO,EAAhB,CAAmBnO,IAAnB,CAAwBO,KAAK,CAACT,SAA9B,EAAyC,6HAAzC,EAAwKmC,oBAAxK;AACA1B,KAAK,CAACT,SAAN,CAAgBqO,EAAhB,CAAmBnO,IAAnB,CAAwBO,KAAK,CAACT,SAA9B,EAAyC,6EAAzC,EAAwHqC,wBAAxH;AACA5B,KAAK,CAACT,SAAN,CAAgBqO,EAAhB,CAAmBnO,IAAnB,CAAwBO,KAAK,CAACT,SAA9B,EAAyC,iJAAzC,EAA4LsC,sBAA5L;AACA7B,KAAK,CAACT,SAAN,CAAgBqO,EAAhB,CAAmBnO,IAAnB,CAAwBO,KAAK,CAACT,SAA9B,EAAyC,uOAAzC,EAAkRuC,yBAAlR;AACA9B,KAAK,CAACT,SAAN,CAAgBqO,EAAhB,CAAmBnO,IAAnB,CAAwBO,KAAK,CAACT,SAA9B,EAAyC,yTAAzC,EAAoWwC,yBAApW;AACA3B,SAAS,CAACyN,OAAV,CAAkBC,eAAlB,CAAkC9N,KAAlC,EAAyC,QAAzC,EAAmD+N,SAAnD,EAA8DzN,YAAY,CAAC0N,4BAAb,EAA9D;AACA5N,SAAS,CAACyN,OAAV,CAAkBC,eAAlB,CAAkC9N,KAAlC,EAAyC,aAAzC,EAAwD,CAAxD,EAA2DM,YAAY,CAAC2N,kBAAb,EAA3D;AACA7N,SAAS,CAACyN,OAAV,CAAkBC,eAAlB,CAAkC9N,KAAlC,EAAyC,wBAAzC,EAAmE,KAAnE;AACAI,SAAS,CAACyN,OAAV,CAAkBC,eAAlB,CAAkC9N,KAAlC,EAAyC,gBAAzC,EAA2D,MAA3D,EAAmEM,YAAY,CAAC4N,wBAAb,EAAnE;AACA9N,SAAS,CAACyN,OAAV,CAAkBC,eAAlB,CAAkC9N,KAAlC,EAAyC,kBAAzC,EAA6D,IAA7D,EAAmEM,YAAY,CAAC6N,mBAAb,EAAnE;AACA/N,SAAS,CAACyN,OAAV,CAAkBC,eAAlB,CAAkC9N,KAAlC,EAAyC,oBAAzC,EAA+D,IAA/D,EAAqEM,YAAY,CAAC6N,mBAAb,EAArE;AACA/N,SAAS,CAACyN,OAAV,CAAkBC,eAAlB,CAAkC9N,KAAlC,EAAyC,wBAAzC,EAAmE,IAAnE,EAAyEM,YAAY,CAAC6N,mBAAb,EAAzE;AACA/N,SAAS,CAACyN,OAAV,CAAkBC,eAAlB,CAAkC9N,KAAlC,EAAyC,UAAzC;AACAI,SAAS,CAACyN,OAAV,CAAkBC,eAAlB,CAAkC9N,KAAlC,EAAyC,SAAzC;AACAI,SAAS,CAACyN,OAAV,CAAkBC,eAAlB,CAAkC9N,KAAlC,EAAyC,WAAzC;AACAI,SAAS,CAACyN,OAAV,CAAkBC,eAAlB,CAAkC9N,KAAlC,EAAyC,SAAzC;AACAI,SAAS,CAACyN,OAAV,CAAkBC,eAAlB,CAAkC9N,KAAlC,EAAyC,MAAzC;AACAI,SAAS,CAACyN,OAAV,CAAkBC,eAAlB,CAAkC9N,KAAlC,EAAyC,YAAzC,EAAuD,CAAvD,EAA0DM,YAAY,CAAC2N,kBAAb,EAA1D;AACA7N,SAAS,CAACyN,OAAV,CAAkBC,eAAlB,CAAkC9N,KAAlC,EAAyC,aAAzC,EAAwD+N,SAAxD,EAAmEzN,YAAY,CAAC8N,kBAAb,EAAnE;AACAhO,SAAS,CAACyN,OAAV,CAAkBC,eAAlB,CAAkC9N,KAAlC,EAAyC,YAAzC,EAAuD,CAAvD,EAA0DM,YAAY,CAAC2N,kBAAb,EAA1D;AACA7N,SAAS,CAACyN,OAAV,CAAkBC,eAAlB,CAAkC9N,KAAlC,EAAyC,eAAzC,EAA0D,CAA1D,EAA6DM,YAAY,CAAC2N,kBAAb,EAA7D;AACA7N,SAAS,CAACyN,OAAV,CAAkBQ,yBAAlB,CAA4CrO,KAA5C,EAAmD,cAAnD,EAAmE,CAAC,GAAD,EAAM,GAAN,CAAnE;AACAI,SAAS,CAACyN,OAAV,CAAkBC,eAAlB,CAAkC9N,KAAlC,EAAyC,eAAzC,EAA0D,CAA1D,EAA6DM,YAAY,CAAC2N,kBAAb,EAA7D;AACA7N,SAAS,CAACyN,OAAV,CAAkBC,eAAlB,CAAkC9N,KAAlC,EAAyC,eAAzC,EAA0D,CAA1D,EAA6DM,YAAY,CAAC2N,kBAAb,EAA7D;AACA7N,SAAS,CAACyN,OAAV,CAAkBC,eAAlB,CAAkC9N,KAAlC,EAAyC,kBAAzC;AACAI,SAAS,CAACyN,OAAV,CAAkBC,eAAlB,CAAkC9N,KAAlC,EAAyC,MAAzC,EAAiD+N,SAAjD,EAA4DzN,YAAY,CAAC0N,4BAAb,EAA5D;AACA5N,SAAS,CAACyN,OAAV,CAAkBC,eAAlB,CAAkC9N,KAAlC,EAAyC,cAAzC,EAAyD,CAAzD,EAA4DM,YAAY,CAAC2N,kBAAb,EAA5D;AACA7N,SAAS,CAACyN,OAAV,CAAkBC,eAAlB,CAAkC9N,KAAlC,EAAyC,cAAzC,EAAyD,CAAzD,EAA4DM,YAAY,CAAC2N,kBAAb,EAA5D;AACA7N,SAAS,CAACyN,OAAV,CAAkBC,eAAlB,CAAkC9N,KAAlC,EAAyC,8BAAzC;AACAI,SAAS,CAACyN,OAAV,CAAkBC,eAAlB,CAAkC9N,KAAlC,EAAyC,gCAAzC;AACAI,SAAS,CAACyN,OAAV,CAAkBC,eAAlB,CAAkC9N,KAAlC,EAAyC,+BAAzC,EAA0E,CAA1E;AACAI,SAAS,CAACyN,OAAV,CAAkBC,eAAlB,CAAkC9N,KAAlC,EAAyC,6BAAzC,EAAwE,CAAxE;AACAI,SAAS,CAACyN,OAAV,CAAkBC,eAAlB,CAAkC9N,KAAlC,EAAyC,8BAAzC;AACAI,SAAS,CAACyN,OAAV,CAAkBC,eAAlB,CAAkC9N,KAAlC,EAAyC,mBAAzC,EAA8D,QAA9D;AACAI,SAAS,CAACyN,OAAV,CAAkBC,eAAlB,CAAkC9N,KAAlC,EAAyC,aAAzC,EAAwD,IAAxD;AACAI,SAAS,CAACyN,OAAV,CAAkBC,eAAlB,CAAkC9N,KAAlC,EAAyC,eAAzC,EAA0D,IAA1D;AACAI,SAAS,CAACyN,OAAV,CAAkBC,eAAlB,CAAkC9N,KAAlC,EAAyC,eAAzC,EAA0D,IAA1D;AACAI,SAAS,CAACyN,OAAV,CAAkBC,eAAlB,CAAkC9N,KAAlC,EAAyC,aAAzC,EAAwD,IAAxD;AACAI,SAAS,CAACyN,OAAV,CAAkBC,eAAlB,CAAkC9N,KAAlC,EAAyC,oBAAzC,EAA+D,IAA/D;AACAI,SAAS,CAACyN,OAAV,CAAkBC,eAAlB,CAAkC9N,KAAlC,EAAyC,cAAzC,EAAyD,OAAzD;AACAI,SAAS,CAACyN,OAAV,CAAkBQ,yBAAlB,CAA4CrO,KAA5C,EAAmD,mBAAnD,EAAwE,CAAC,GAAD,EAAM,GAAN,CAAxE;AACAI,SAAS,CAACyN,OAAV,CAAkBC,eAAlB,CAAkC9N,KAAlC,EAAyC,oBAAzC,EAA+D,CAA/D,EAAkEM,YAAY,CAAC2N,kBAAb,EAAlE;AACA7N,SAAS,CAACyN,OAAV,CAAkBC,eAAlB,CAAkC9N,KAAlC,EAAyC,oBAAzC,EAA+D,CAA/D,EAAkEM,YAAY,CAAC2N,kBAAb,EAAlE;AACA7N,SAAS,CAACyN,OAAV,CAAkBQ,yBAAlB,CAA4CrO,KAA5C,EAAmD,kBAAnD,EAAuE,CAAC,GAAD,EAAM,GAAN,CAAvE;AACAI,SAAS,CAACyN,OAAV,CAAkBC,eAAlB,CAAkC9N,KAAlC,EAAyC,mBAAzC,EAA8D,CAA9D,EAAiEM,YAAY,CAAC2N,kBAAb,EAAjE;AACA7N,SAAS,CAACyN,OAAV,CAAkBC,eAAlB,CAAkC9N,KAAlC,EAAyC,mBAAzC,EAA8D,CAA9D,EAAiEM,YAAY,CAAC2N,kBAAb,EAAjE;AACA7N,SAAS,CAACyN,OAAV,CAAkBQ,yBAAlB,CAA4CrO,KAA5C,EAAmD,8BAAnD,EAAmF,CAC/E,GAD+E,EAE/E,GAF+E,CAAnF;AAIAI,SAAS,CAACyN,OAAV,CAAkBQ,yBAAlB,CAA4CrO,KAA5C,EAAmD,gCAAnD,EAAqF,CACjF,GADiF,EAEjF,GAFiF,CAArF;AAIAI,SAAS,CAACyN,OAAV,CAAkBC,eAAlB,CAAkC9N,KAAlC,EAAyC,+BAAzC,EAA0E,CAA1E;AACAI,SAAS,CAACyN,OAAV,CAAkBC,eAAlB,CAAkC9N,KAAlC,EAAyC,iCAAzC,EAA4E,CAA5E;AACAI,SAAS,CAACyN,OAAV,CAAkBC,eAAlB,CAAkC9N,KAAlC,EAAyC,+BAAzC,EAA0E,CAA1E;AACAI,SAAS,CAACyN,OAAV,CAAkBC,eAAlB,CAAkC9N,KAAlC,EAAyC,iCAAzC,EAA4E,CAA5E;AACAI,SAAS,CAACyN,OAAV,CAAkBQ,yBAAlB,CAA4CrO,KAA5C,EAAmD,4BAAnD,EAAiF,CAC7E,GAD6E,EAE7E,GAF6E,CAAjF;AAIAI,SAAS,CAACyN,OAAV,CAAkBQ,yBAAlB,CAA4CrO,KAA5C,EAAmD,8BAAnD,EAAmF,CAC/E,GAD+E,EAE/E,GAF+E,CAAnF;AAIAI,SAAS,CAACyN,OAAV,CAAkBC,eAAlB,CAAkC9N,KAAlC,EAAyC,6BAAzC,EAAwE,CAAxE;AACAI,SAAS,CAACyN,OAAV,CAAkBC,eAAlB,CAAkC9N,KAAlC,EAAyC,+BAAzC,EAA0E,CAA1E;AACAI,SAAS,CAACyN,OAAV,CAAkBC,eAAlB,CAAkC9N,KAAlC,EAAyC,6BAAzC,EAAwE,CAAxE;AACAI,SAAS,CAACyN,OAAV,CAAkBC,eAAlB,CAAkC9N,KAAlC,EAAyC,+BAAzC,EAA0E,CAA1E;AACAI,SAAS,CAACyN,OAAV,CAAkBQ,yBAAlB,CAA4CrO,KAA5C,EAAmD,8BAAnD,EAAmF,CAC/E,GAD+E,EAE/E,GAF+E,CAAnF;AAIAI,SAAS,CAACyN,OAAV,CAAkBC,eAAlB,CAAkC9N,KAAlC,EAAyC,+BAAzC,EAA0E,CAA1E;AACAI,SAAS,CAACyN,OAAV,CAAkBC,eAAlB,CAAkC9N,KAAlC,EAAyC,+BAAzC,EAA0E,CAA1E;AACAI,SAAS,CAACyN,OAAV,CAAkBQ,yBAAlB,CAA4CrO,KAA5C,EAAmD,4BAAnD,EAAiF,CAC7E,GAD6E,EAE7E,GAF6E,CAAjF;AAIAI,SAAS,CAACyN,OAAV,CAAkBC,eAAlB,CAAkC9N,KAAlC,EAAyC,6BAAzC,EAAwE,CAAxE;AACAI,SAAS,CAACyN,OAAV,CAAkBC,eAAlB,CAAkC9N,KAAlC,EAAyC,6BAAzC,EAAwE,CAAxE;AACAI,SAAS,CAACyN,OAAV,CAAkBC,eAAlB,CAAkC9N,KAAlC,EAAyC,qBAAzC,EAAgE,CAAhE;AACAI,SAAS,CAACyN,OAAV,CAAkBS,UAAlB,CAA6BtO,KAA7B,EAAoC;AAChCuO,EAAAA,SAAS,EAAE,MADqB;AAEhCC,EAAAA,YAAY,EAAE,SAFkB;AAGhCC,EAAAA,YAAY,EAAE,SAHkB;AAIhCxE,EAAAA,QAAQ,EAAE,WAJsB;AAKhCyE,EAAAA,WAAW,EAAE,cALmB;AAMhCC,EAAAA,WAAW,EAAE,cANmB;AAOhCC,EAAAA,WAAW,EAAE,SAPmB;AAQhCC,EAAAA,cAAc,EAAE,YARgB;AAShCC,EAAAA,cAAc,EAAE;AATgB,CAApC;AAWA5O,MAAM,CAAC6O,UAAP,CAAkBC,UAAlB,CAA6BhP,KAA7B","sourcesContent":["\"use strict\";\nvar __extends = (this && this.__extends) || (function () {\n    var extendStatics = function (d, b) {\n        extendStatics = Object.setPrototypeOf ||\n            ({ __proto__: [] } instanceof Array && function (d, b) { d.__proto__ = b; }) ||\n            function (d, b) { for (var p in b) if (Object.prototype.hasOwnProperty.call(b, p)) d[p] = b[p]; };\n        return extendStatics(d, b);\n    };\n    return function (d, b) {\n        extendStatics(d, b);\n        function __() { this.constructor = d; }\n        d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());\n    };\n})();\nObject.defineProperty(exports, \"__esModule\", { value: true });\nexports.Shape = exports.shapes = void 0;\nvar Util_1 = require(\"./Util\");\nvar Factory_1 = require(\"./Factory\");\nvar Node_1 = require(\"./Node\");\nvar Validators_1 = require(\"./Validators\");\nvar Global_1 = require(\"./Global\");\nvar PointerEvents = require(\"./PointerEvents\");\nvar HAS_SHADOW = 'hasShadow';\nvar SHADOW_RGBA = 'shadowRGBA';\nvar patternImage = 'patternImage';\nvar linearGradient = 'linearGradient';\nvar radialGradient = 'radialGradient';\nvar dummyContext;\nfunction getDummyContext() {\n    if (dummyContext) {\n        return dummyContext;\n    }\n    dummyContext = Util_1.Util.createCanvasElement().getContext('2d');\n    return dummyContext;\n}\nexports.shapes = {};\nfunction _fillFunc(context) {\n    context.fill();\n}\nfunction _strokeFunc(context) {\n    context.stroke();\n}\nfunction _fillFuncHit(context) {\n    context.fill();\n}\nfunction _strokeFuncHit(context) {\n    context.stroke();\n}\nfunction _clearHasShadowCache() {\n    this._clearCache(HAS_SHADOW);\n}\nfunction _clearGetShadowRGBACache() {\n    this._clearCache(SHADOW_RGBA);\n}\nfunction _clearFillPatternCache() {\n    this._clearCache(patternImage);\n}\nfunction _clearLinearGradientCache() {\n    this._clearCache(linearGradient);\n}\nfunction _clearRadialGradientCache() {\n    this._clearCache(radialGradient);\n}\nvar Shape = (function (_super) {\n    __extends(Shape, _super);\n    function Shape(config) {\n        var _this = _super.call(this, config) || this;\n        var key;\n        while (true) {\n            key = Util_1.Util.getRandomColor();\n            if (key && !(key in exports.shapes)) {\n                break;\n            }\n        }\n        _this.colorKey = key;\n        exports.shapes[key] = _this;\n        return _this;\n    }\n    Shape.prototype.getContext = function () {\n        return this.getLayer().getContext();\n    };\n    Shape.prototype.getCanvas = function () {\n        return this.getLayer().getCanvas();\n    };\n    Shape.prototype.getSceneFunc = function () {\n        return this.attrs.sceneFunc || this['_sceneFunc'];\n    };\n    Shape.prototype.getHitFunc = function () {\n        return this.attrs.hitFunc || this['_hitFunc'];\n    };\n    Shape.prototype.hasShadow = function () {\n        return this._getCache(HAS_SHADOW, this._hasShadow);\n    };\n    Shape.prototype._hasShadow = function () {\n        return (this.shadowEnabled() &&\n            this.shadowOpacity() !== 0 &&\n            !!(this.shadowColor() ||\n                this.shadowBlur() ||\n                this.shadowOffsetX() ||\n                this.shadowOffsetY()));\n    };\n    Shape.prototype._getFillPattern = function () {\n        return this._getCache(patternImage, this.__getFillPattern);\n    };\n    Shape.prototype.__getFillPattern = function () {\n        if (this.fillPatternImage()) {\n            var ctx = getDummyContext();\n            var pattern = ctx.createPattern(this.fillPatternImage(), this.fillPatternRepeat() || 'repeat');\n            if (pattern && pattern.setTransform) {\n                pattern.setTransform({\n                    a: this.fillPatternScaleX(),\n                    b: 0,\n                    c: 0,\n                    d: this.fillPatternScaleY(),\n                    e: 0,\n                    f: 0,\n                });\n            }\n            return pattern;\n        }\n    };\n    Shape.prototype._getLinearGradient = function () {\n        return this._getCache(linearGradient, this.__getLinearGradient);\n    };\n    Shape.prototype.__getLinearGradient = function () {\n        var colorStops = this.fillLinearGradientColorStops();\n        if (colorStops) {\n            var ctx = getDummyContext();\n            var start = this.fillLinearGradientStartPoint();\n            var end = this.fillLinearGradientEndPoint();\n            var grd = ctx.createLinearGradient(start.x, start.y, end.x, end.y);\n            for (var n = 0; n < colorStops.length; n += 2) {\n                grd.addColorStop(colorStops[n], colorStops[n + 1]);\n            }\n            return grd;\n        }\n    };\n    Shape.prototype._getRadialGradient = function () {\n        return this._getCache(radialGradient, this.__getRadialGradient);\n    };\n    Shape.prototype.__getRadialGradient = function () {\n        var colorStops = this.fillRadialGradientColorStops();\n        if (colorStops) {\n            var ctx = getDummyContext();\n            var start = this.fillRadialGradientStartPoint();\n            var end = this.fillRadialGradientEndPoint();\n            var grd = ctx.createRadialGradient(start.x, start.y, this.fillRadialGradientStartRadius(), end.x, end.y, this.fillRadialGradientEndRadius());\n            for (var n = 0; n < colorStops.length; n += 2) {\n                grd.addColorStop(colorStops[n], colorStops[n + 1]);\n            }\n            return grd;\n        }\n    };\n    Shape.prototype.getShadowRGBA = function () {\n        return this._getCache(SHADOW_RGBA, this._getShadowRGBA);\n    };\n    Shape.prototype._getShadowRGBA = function () {\n        if (this.hasShadow()) {\n            var rgba = Util_1.Util.colorToRGBA(this.shadowColor());\n            return ('rgba(' +\n                rgba.r +\n                ',' +\n                rgba.g +\n                ',' +\n                rgba.b +\n                ',' +\n                rgba.a * (this.shadowOpacity() || 1) +\n                ')');\n        }\n    };\n    Shape.prototype.hasFill = function () {\n        var _this = this;\n        return this._calculate('hasFill', [\n            'fillEnabled',\n            'fill',\n            'fillPatternImage',\n            'fillLinearGradientColorStops',\n            'fillRadialGradientColorStops',\n        ], function () {\n            return (_this.fillEnabled() &&\n                !!(_this.fill() ||\n                    _this.fillPatternImage() ||\n                    _this.fillLinearGradientColorStops() ||\n                    _this.fillRadialGradientColorStops()));\n        });\n    };\n    Shape.prototype.hasStroke = function () {\n        var _this = this;\n        return this._calculate('hasStroke', [\n            'strokeEnabled',\n            'strokeWidth',\n            'stroke',\n            'strokeLinearGradientColorStops',\n        ], function () {\n            return (_this.strokeEnabled() &&\n                _this.strokeWidth() &&\n                !!(_this.stroke() || _this.strokeLinearGradientColorStops()));\n        });\n    };\n    Shape.prototype.hasHitStroke = function () {\n        var width = this.hitStrokeWidth();\n        if (width === 'auto') {\n            return this.hasStroke();\n        }\n        return this.strokeEnabled() && !!width;\n    };\n    Shape.prototype.intersects = function (point) {\n        var stage = this.getStage(), bufferHitCanvas = stage.bufferHitCanvas, p;\n        bufferHitCanvas.getContext().clear();\n        this.drawHit(bufferHitCanvas, null, true);\n        p = bufferHitCanvas.context.getImageData(Math.round(point.x), Math.round(point.y), 1, 1).data;\n        return p[3] > 0;\n    };\n    Shape.prototype.destroy = function () {\n        Node_1.Node.prototype.destroy.call(this);\n        delete exports.shapes[this.colorKey];\n        delete this.colorKey;\n        return this;\n    };\n    Shape.prototype._useBufferCanvas = function (forceFill) {\n        var _a;\n        if (!this.getStage()) {\n            return false;\n        }\n        var perfectDrawEnabled = (_a = this.attrs.perfectDrawEnabled) !== null && _a !== void 0 ? _a : true;\n        if (!perfectDrawEnabled) {\n            return false;\n        }\n        var hasFill = forceFill || this.hasFill();\n        var hasStroke = this.hasStroke();\n        var isTransparent = this.getAbsoluteOpacity() !== 1;\n        if (hasFill && hasStroke && isTransparent) {\n            return true;\n        }\n        var hasShadow = this.hasShadow();\n        var strokeForShadow = this.shadowForStrokeEnabled();\n        if (hasFill && hasStroke && hasShadow && strokeForShadow) {\n            return true;\n        }\n        return false;\n    };\n    Shape.prototype.setStrokeHitEnabled = function (val) {\n        Util_1.Util.warn('strokeHitEnabled property is deprecated. Please use hitStrokeWidth instead.');\n        if (val) {\n            this.hitStrokeWidth('auto');\n        }\n        else {\n            this.hitStrokeWidth(0);\n        }\n    };\n    Shape.prototype.getStrokeHitEnabled = function () {\n        if (this.hitStrokeWidth() === 0) {\n            return false;\n        }\n        else {\n            return true;\n        }\n    };\n    Shape.prototype.getSelfRect = function () {\n        var size = this.size();\n        return {\n            x: this._centroid ? -size.width / 2 : 0,\n            y: this._centroid ? -size.height / 2 : 0,\n            width: size.width,\n            height: size.height,\n        };\n    };\n    Shape.prototype.getClientRect = function (config) {\n        if (config === void 0) { config = {}; }\n        var skipTransform = config.skipTransform;\n        var relativeTo = config.relativeTo;\n        var fillRect = this.getSelfRect();\n        var applyStroke = !config.skipStroke && this.hasStroke();\n        var strokeWidth = (applyStroke && this.strokeWidth()) || 0;\n        var fillAndStrokeWidth = fillRect.width + strokeWidth;\n        var fillAndStrokeHeight = fillRect.height + strokeWidth;\n        var applyShadow = !config.skipShadow && this.hasShadow();\n        var shadowOffsetX = applyShadow ? this.shadowOffsetX() : 0;\n        var shadowOffsetY = applyShadow ? this.shadowOffsetY() : 0;\n        var preWidth = fillAndStrokeWidth + Math.abs(shadowOffsetX);\n        var preHeight = fillAndStrokeHeight + Math.abs(shadowOffsetY);\n        var blurRadius = (applyShadow && this.shadowBlur()) || 0;\n        var width = preWidth + blurRadius * 2;\n        var height = preHeight + blurRadius * 2;\n        var roundingOffset = 0;\n        if (Math.round(strokeWidth / 2) !== strokeWidth / 2) {\n            roundingOffset = 1;\n        }\n        var rect = {\n            width: width + roundingOffset,\n            height: height + roundingOffset,\n            x: -Math.round(strokeWidth / 2 + blurRadius) +\n                Math.min(shadowOffsetX, 0) +\n                fillRect.x,\n            y: -Math.round(strokeWidth / 2 + blurRadius) +\n                Math.min(shadowOffsetY, 0) +\n                fillRect.y,\n        };\n        if (!skipTransform) {\n            return this._transformedRect(rect, relativeTo);\n        }\n        return rect;\n    };\n    Shape.prototype.drawScene = function (can, top) {\n        var layer = this.getLayer(), canvas = can || layer.getCanvas(), context = canvas.getContext(), cachedCanvas = this._getCanvasCache(), drawFunc = this.getSceneFunc(), hasShadow = this.hasShadow(), stage, bufferCanvas, bufferContext;\n        var caching = canvas.isCache;\n        var skipBuffer = canvas.isCache;\n        var cachingSelf = top === this;\n        if (!this.isVisible() && !caching) {\n            return this;\n        }\n        if (cachedCanvas) {\n            context.save();\n            var m = this.getAbsoluteTransform(top).getMatrix();\n            context.transform(m[0], m[1], m[2], m[3], m[4], m[5]);\n            this._drawCachedSceneCanvas(context);\n            context.restore();\n            return this;\n        }\n        if (!drawFunc) {\n            return this;\n        }\n        context.save();\n        if (this._useBufferCanvas() && !skipBuffer) {\n            stage = this.getStage();\n            bufferCanvas = stage.bufferCanvas;\n            bufferContext = bufferCanvas.getContext();\n            bufferContext.clear();\n            bufferContext.save();\n            bufferContext._applyLineJoin(this);\n            var o = this.getAbsoluteTransform(top).getMatrix();\n            bufferContext.transform(o[0], o[1], o[2], o[3], o[4], o[5]);\n            drawFunc.call(this, bufferContext, this);\n            bufferContext.restore();\n            var ratio = bufferCanvas.pixelRatio;\n            if (hasShadow) {\n                context._applyShadow(this);\n            }\n            context._applyOpacity(this);\n            context._applyGlobalCompositeOperation(this);\n            context.drawImage(bufferCanvas._canvas, 0, 0, bufferCanvas.width / ratio, bufferCanvas.height / ratio);\n        }\n        else {\n            context._applyLineJoin(this);\n            if (!cachingSelf) {\n                var o = this.getAbsoluteTransform(top).getMatrix();\n                context.transform(o[0], o[1], o[2], o[3], o[4], o[5]);\n                context._applyOpacity(this);\n                context._applyGlobalCompositeOperation(this);\n            }\n            if (hasShadow) {\n                context._applyShadow(this);\n            }\n            drawFunc.call(this, context, this);\n        }\n        context.restore();\n        return this;\n    };\n    Shape.prototype.drawHit = function (can, top, skipDragCheck) {\n        if (skipDragCheck === void 0) { skipDragCheck = false; }\n        if (!this.shouldDrawHit(top, skipDragCheck)) {\n            return this;\n        }\n        var layer = this.getLayer(), canvas = can || layer.hitCanvas, context = canvas && canvas.getContext(), drawFunc = this.hitFunc() || this.sceneFunc(), cachedCanvas = this._getCanvasCache(), cachedHitCanvas = cachedCanvas && cachedCanvas.hit;\n        if (!this.colorKey) {\n            console.log(this);\n            Util_1.Util.warn('Looks like your canvas has a destroyed shape in it. Do not reuse shape after you destroyed it. See the shape in logs above. If you want to reuse shape you should call remove() instead of destroy()');\n        }\n        if (cachedHitCanvas) {\n            context.save();\n            var m = this.getAbsoluteTransform(top).getMatrix();\n            context.transform(m[0], m[1], m[2], m[3], m[4], m[5]);\n            this._drawCachedHitCanvas(context);\n            context.restore();\n            return this;\n        }\n        if (!drawFunc) {\n            return this;\n        }\n        context.save();\n        context._applyLineJoin(this);\n        var selfCache = this === top;\n        if (!selfCache) {\n            var o = this.getAbsoluteTransform(top).getMatrix();\n            context.transform(o[0], o[1], o[2], o[3], o[4], o[5]);\n        }\n        drawFunc.call(this, context, this);\n        context.restore();\n        return this;\n    };\n    Shape.prototype.drawHitFromCache = function (alphaThreshold) {\n        if (alphaThreshold === void 0) { alphaThreshold = 0; }\n        var cachedCanvas = this._getCanvasCache(), sceneCanvas = this._getCachedSceneCanvas(), hitCanvas = cachedCanvas.hit, hitContext = hitCanvas.getContext(), hitWidth = hitCanvas.getWidth(), hitHeight = hitCanvas.getHeight(), hitImageData, hitData, len, rgbColorKey, i, alpha;\n        hitContext.clear();\n        hitContext.drawImage(sceneCanvas._canvas, 0, 0, hitWidth, hitHeight);\n        try {\n            hitImageData = hitContext.getImageData(0, 0, hitWidth, hitHeight);\n            hitData = hitImageData.data;\n            len = hitData.length;\n            rgbColorKey = Util_1.Util._hexToRgb(this.colorKey);\n            for (i = 0; i < len; i += 4) {\n                alpha = hitData[i + 3];\n                if (alpha > alphaThreshold) {\n                    hitData[i] = rgbColorKey.r;\n                    hitData[i + 1] = rgbColorKey.g;\n                    hitData[i + 2] = rgbColorKey.b;\n                    hitData[i + 3] = 255;\n                }\n                else {\n                    hitData[i + 3] = 0;\n                }\n            }\n            hitContext.putImageData(hitImageData, 0, 0);\n        }\n        catch (e) {\n            Util_1.Util.error('Unable to draw hit graph from cached scene canvas. ' + e.message);\n        }\n        return this;\n    };\n    Shape.prototype.hasPointerCapture = function (pointerId) {\n        return PointerEvents.hasPointerCapture(pointerId, this);\n    };\n    Shape.prototype.setPointerCapture = function (pointerId) {\n        PointerEvents.setPointerCapture(pointerId, this);\n    };\n    Shape.prototype.releaseCapture = function (pointerId) {\n        PointerEvents.releaseCapture(pointerId, this);\n    };\n    return Shape;\n}(Node_1.Node));\nexports.Shape = Shape;\nShape.prototype._fillFunc = _fillFunc;\nShape.prototype._strokeFunc = _strokeFunc;\nShape.prototype._fillFuncHit = _fillFuncHit;\nShape.prototype._strokeFuncHit = _strokeFuncHit;\nShape.prototype._centroid = false;\nShape.prototype.nodeType = 'Shape';\nGlobal_1._registerNode(Shape);\nShape.prototype.eventListeners = {};\nShape.prototype.on.call(Shape.prototype, 'shadowColorChange.konva shadowBlurChange.konva shadowOffsetChange.konva shadowOpacityChange.konva shadowEnabledChange.konva', _clearHasShadowCache);\nShape.prototype.on.call(Shape.prototype, 'shadowColorChange.konva shadowOpacityChange.konva shadowEnabledChange.konva', _clearGetShadowRGBACache);\nShape.prototype.on.call(Shape.prototype, 'fillPriorityChange.konva fillPatternImageChange.konva fillPatternRepeatChange.konva fillPatternScaleXChange.konva fillPatternScaleYChange.konva', _clearFillPatternCache);\nShape.prototype.on.call(Shape.prototype, 'fillPriorityChange.konva fillLinearGradientColorStopsChange.konva fillLinearGradientStartPointXChange.konva fillLinearGradientStartPointYChange.konva fillLinearGradientEndPointXChange.konva fillLinearGradientEndPointYChange.konva', _clearLinearGradientCache);\nShape.prototype.on.call(Shape.prototype, 'fillPriorityChange.konva fillRadialGradientColorStopsChange.konva fillRadialGradientStartPointXChange.konva fillRadialGradientStartPointYChange.konva fillRadialGradientEndPointXChange.konva fillRadialGradientEndPointYChange.konva fillRadialGradientStartRadiusChange.konva fillRadialGradientEndRadiusChange.konva', _clearRadialGradientCache);\nFactory_1.Factory.addGetterSetter(Shape, 'stroke', undefined, Validators_1.getStringOrGradientValidator());\nFactory_1.Factory.addGetterSetter(Shape, 'strokeWidth', 2, Validators_1.getNumberValidator());\nFactory_1.Factory.addGetterSetter(Shape, 'fillAfterStrokeEnabled', false);\nFactory_1.Factory.addGetterSetter(Shape, 'hitStrokeWidth', 'auto', Validators_1.getNumberOrAutoValidator());\nFactory_1.Factory.addGetterSetter(Shape, 'strokeHitEnabled', true, Validators_1.getBooleanValidator());\nFactory_1.Factory.addGetterSetter(Shape, 'perfectDrawEnabled', true, Validators_1.getBooleanValidator());\nFactory_1.Factory.addGetterSetter(Shape, 'shadowForStrokeEnabled', true, Validators_1.getBooleanValidator());\nFactory_1.Factory.addGetterSetter(Shape, 'lineJoin');\nFactory_1.Factory.addGetterSetter(Shape, 'lineCap');\nFactory_1.Factory.addGetterSetter(Shape, 'sceneFunc');\nFactory_1.Factory.addGetterSetter(Shape, 'hitFunc');\nFactory_1.Factory.addGetterSetter(Shape, 'dash');\nFactory_1.Factory.addGetterSetter(Shape, 'dashOffset', 0, Validators_1.getNumberValidator());\nFactory_1.Factory.addGetterSetter(Shape, 'shadowColor', undefined, Validators_1.getStringValidator());\nFactory_1.Factory.addGetterSetter(Shape, 'shadowBlur', 0, Validators_1.getNumberValidator());\nFactory_1.Factory.addGetterSetter(Shape, 'shadowOpacity', 1, Validators_1.getNumberValidator());\nFactory_1.Factory.addComponentsGetterSetter(Shape, 'shadowOffset', ['x', 'y']);\nFactory_1.Factory.addGetterSetter(Shape, 'shadowOffsetX', 0, Validators_1.getNumberValidator());\nFactory_1.Factory.addGetterSetter(Shape, 'shadowOffsetY', 0, Validators_1.getNumberValidator());\nFactory_1.Factory.addGetterSetter(Shape, 'fillPatternImage');\nFactory_1.Factory.addGetterSetter(Shape, 'fill', undefined, Validators_1.getStringOrGradientValidator());\nFactory_1.Factory.addGetterSetter(Shape, 'fillPatternX', 0, Validators_1.getNumberValidator());\nFactory_1.Factory.addGetterSetter(Shape, 'fillPatternY', 0, Validators_1.getNumberValidator());\nFactory_1.Factory.addGetterSetter(Shape, 'fillLinearGradientColorStops');\nFactory_1.Factory.addGetterSetter(Shape, 'strokeLinearGradientColorStops');\nFactory_1.Factory.addGetterSetter(Shape, 'fillRadialGradientStartRadius', 0);\nFactory_1.Factory.addGetterSetter(Shape, 'fillRadialGradientEndRadius', 0);\nFactory_1.Factory.addGetterSetter(Shape, 'fillRadialGradientColorStops');\nFactory_1.Factory.addGetterSetter(Shape, 'fillPatternRepeat', 'repeat');\nFactory_1.Factory.addGetterSetter(Shape, 'fillEnabled', true);\nFactory_1.Factory.addGetterSetter(Shape, 'strokeEnabled', true);\nFactory_1.Factory.addGetterSetter(Shape, 'shadowEnabled', true);\nFactory_1.Factory.addGetterSetter(Shape, 'dashEnabled', true);\nFactory_1.Factory.addGetterSetter(Shape, 'strokeScaleEnabled', true);\nFactory_1.Factory.addGetterSetter(Shape, 'fillPriority', 'color');\nFactory_1.Factory.addComponentsGetterSetter(Shape, 'fillPatternOffset', ['x', 'y']);\nFactory_1.Factory.addGetterSetter(Shape, 'fillPatternOffsetX', 0, Validators_1.getNumberValidator());\nFactory_1.Factory.addGetterSetter(Shape, 'fillPatternOffsetY', 0, Validators_1.getNumberValidator());\nFactory_1.Factory.addComponentsGetterSetter(Shape, 'fillPatternScale', ['x', 'y']);\nFactory_1.Factory.addGetterSetter(Shape, 'fillPatternScaleX', 1, Validators_1.getNumberValidator());\nFactory_1.Factory.addGetterSetter(Shape, 'fillPatternScaleY', 1, Validators_1.getNumberValidator());\nFactory_1.Factory.addComponentsGetterSetter(Shape, 'fillLinearGradientStartPoint', [\n    'x',\n    'y',\n]);\nFactory_1.Factory.addComponentsGetterSetter(Shape, 'strokeLinearGradientStartPoint', [\n    'x',\n    'y',\n]);\nFactory_1.Factory.addGetterSetter(Shape, 'fillLinearGradientStartPointX', 0);\nFactory_1.Factory.addGetterSetter(Shape, 'strokeLinearGradientStartPointX', 0);\nFactory_1.Factory.addGetterSetter(Shape, 'fillLinearGradientStartPointY', 0);\nFactory_1.Factory.addGetterSetter(Shape, 'strokeLinearGradientStartPointY', 0);\nFactory_1.Factory.addComponentsGetterSetter(Shape, 'fillLinearGradientEndPoint', [\n    'x',\n    'y',\n]);\nFactory_1.Factory.addComponentsGetterSetter(Shape, 'strokeLinearGradientEndPoint', [\n    'x',\n    'y',\n]);\nFactory_1.Factory.addGetterSetter(Shape, 'fillLinearGradientEndPointX', 0);\nFactory_1.Factory.addGetterSetter(Shape, 'strokeLinearGradientEndPointX', 0);\nFactory_1.Factory.addGetterSetter(Shape, 'fillLinearGradientEndPointY', 0);\nFactory_1.Factory.addGetterSetter(Shape, 'strokeLinearGradientEndPointY', 0);\nFactory_1.Factory.addComponentsGetterSetter(Shape, 'fillRadialGradientStartPoint', [\n    'x',\n    'y',\n]);\nFactory_1.Factory.addGetterSetter(Shape, 'fillRadialGradientStartPointX', 0);\nFactory_1.Factory.addGetterSetter(Shape, 'fillRadialGradientStartPointY', 0);\nFactory_1.Factory.addComponentsGetterSetter(Shape, 'fillRadialGradientEndPoint', [\n    'x',\n    'y',\n]);\nFactory_1.Factory.addGetterSetter(Shape, 'fillRadialGradientEndPointX', 0);\nFactory_1.Factory.addGetterSetter(Shape, 'fillRadialGradientEndPointY', 0);\nFactory_1.Factory.addGetterSetter(Shape, 'fillPatternRotation', 0);\nFactory_1.Factory.backCompat(Shape, {\n    dashArray: 'dash',\n    getDashArray: 'getDash',\n    setDashArray: 'getDash',\n    drawFunc: 'sceneFunc',\n    getDrawFunc: 'getSceneFunc',\n    setDrawFunc: 'setSceneFunc',\n    drawHitFunc: 'hitFunc',\n    getDrawHitFunc: 'getHitFunc',\n    setDrawHitFunc: 'setHitFunc',\n});\nUtil_1.Collection.mapMethods(Shape);\n"]},"metadata":{},"sourceType":"script"}