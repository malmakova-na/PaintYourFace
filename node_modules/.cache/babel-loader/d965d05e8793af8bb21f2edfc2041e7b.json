{"ast":null,"code":"var _jsxFileName = \"/home/namina/courses/tinkoff/paint-your-face/src/components/graficEditor/GraficEditor.js\",\n    _s = $RefreshSig$(),\n    _s2 = $RefreshSig$();\n\nimport React, { useRef, useEffect, useState, useCallback } from 'react';\nimport Palette from '../Palette/Palette';\nimport Button from '../Buttons';\nimport LineWidthBar from '../LineWidthBar';\nimport GalleryItem from '../addNewImage';\nimport DeleteButton from '../DeleteButton';\nimport LoadImage from '../LoadImage'; //import FacePaint from '../FaceMash/FacePaint';\n\nimport { faceCanvas } from '../FaceMash/camera';\nimport face from '../images/face.png';\nimport styles from './gallery/Gallery.module.css';\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\n\nfunction useLocalStorage(key, initialValue) {\n  _s();\n\n  const [storedValue, setStoredValue] = useState(() => {\n    try {\n      const item = window.localStorage.getItem(key);\n      return item ? JSON.parse(item) : initialValue;\n    } catch (error) {\n      console.log(error);\n      return initialValue;\n    }\n  });\n\n  const setValue = value => {\n    try {\n      const valueToStore = value instanceof Function ? value(storedValue) : value;\n      setStoredValue(valueToStore);\n      window.localStorage.setItem(key, JSON.stringify(valueToStore));\n    } catch (error) {\n      console.log(error);\n    }\n  };\n\n  return [storedValue, setValue];\n}\n\n_s(useLocalStorage, \"0ueM1jHopzWZoE4BJMANlTJutCE=\");\n\n;\n\nconst Canvas = props => {\n  _s2();\n\n  let [faceCam, setFace] = useState(faceCanvas);\n  let [color, setColor] = useState('black');\n  let [gallery, setImage] = useLocalStorage('gallery', []);\n  let [paths, setPath] = useState([]);\n  let [lineWidth, setLineWidth] = useState(2);\n  let [toggleItem, setToggle] = useState([]);\n  const canvasRef = useRef(null);\n  const draw = useCallback((canvas, color, mode) => {\n    let rememberPath = false;\n    let points = [];\n    let context = canvas.getContext('2d');\n    context.globalCompositeOperation = mode === 'line' ? \"source-over\" : \"destination-out\";\n\n    canvas.onmousemove = function drawIfPressed(e) {\n      let x = e.offsetX;\n      let y = e.offsetY;\n      let dx = e.movementX;\n      let dy = e.movementY;\n      context.lineCap = \"round\";\n      context.lineWidth = lineWidth;\n\n      if (e.buttons > 0) {\n        context.beginPath();\n        context.moveTo(x, y);\n        context.lineTo(x - dx, y - dy);\n        context.stroke();\n        context.strokeStyle = color;\n        context.closePath();\n      }\n\n      if (rememberPath) {\n        points.push({\n          x: x - dx,\n          y: y - dy,\n          color: color,\n          lineWidth: lineWidth\n        });\n      }\n\n      canvas.onmouseup = e => {\n        //не нажата\n        setPath([...paths, points]);\n        rememberPath = false;\n      };\n\n      canvas.onmousedown = e => {\n        //нажата\n        let x = e.offsetX;\n        let y = e.offsetY;\n        let dx = e.movementX;\n        let dy = e.movementY;\n        points = [];\n        rememberPath = true;\n        points.push({\n          x: x - dx,\n          y: y - dy\n        });\n      };\n    };\n  }, [lineWidth, paths]);\n\n  const drawPaths = canvas => {\n    let context = canvas.getContext('2d');\n    context.clearRect(0, 0, canvas.width, canvas.height);\n    paths.forEach(path => {\n      context.beginPath();\n      context.moveTo(path[0].x, path[0].y);\n\n      for (let i = 1; i < path.length; i++) {\n        context.lineTo(path[i].x, path[i].y);\n        context.strokeStyle = path[i].color;\n        context.lineWidth = path[i].lineWidth;\n      }\n\n      context.stroke();\n    });\n  };\n\n  const onChangeLineWidth = width => setLineWidth(width);\n\n  const onChangeColor = color => setColor(color);\n\n  const save = () => {\n    const canvas = canvasRef.current;\n    let dataURL = canvas.toDataURL(\"image/png\", 1.0);\n\n    if (localStorage.getItem('gallery') === null || localStorage.getItem('gallery').includes(dataURL) !== true) {\n      //картинку сохраняем один раз\n      setImage([...gallery, dataURL]);\n    }\n  };\n\n  const clear = () => {\n    const canvas = canvasRef.current;\n    const context = canvas.getContext('2d');\n    context.clearRect(0, 0, canvas.width, canvas.height);\n    setPath([]);\n  };\n\n  const eraser = () => {\n    const canvas = canvasRef.current;\n    draw(canvas, \"rgb(255, 255, 255, 1)\", 'eraser');\n  };\n\n  const undo = () => {\n    const canvas = canvasRef.current;\n    paths.splice(-1, 1);\n    drawPaths(canvas);\n  };\n\n  const toggleStyle = value => {\n    //alert(JSON.stringify( props))\n    setToggle(value);\n    faceCanvas.updateTexture(value);\n    /*if(faceCanvas!==undefined){\n        faceCanvas.updateTexture(value);\n    }\n    else{\n        alert('loading')\n    }*/\n  };\n\n  const addNewImg = dataURL => {\n    setImage([...gallery, dataURL]);\n  };\n\n  const onDelete = item => {\n    setImage(prevActions => prevActions.filter(value => value !== item));\n  };\n\n  useEffect(() => {\n    const canvas = canvasRef.current;\n    alert(faceCam === undefined);\n    draw(canvas, color, 'line');\n  }, [draw, color, gallery, paths, lineWidth, toggleStyle, faceCam]); //, lineWidth, toggleStyle  \n\n  return /*#__PURE__*/_jsxDEV(\"section\", {\n    className: styles.paintWrapper,\n    children: [/*#__PURE__*/_jsxDEV(\"div\", {\n      className: styles.galleryWrapper,\n      children: [/*#__PURE__*/_jsxDEV(\"header\", {\n        className: styles.gallery__heading,\n        children: \"Gallery\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 157,\n        columnNumber: 13\n      }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n        className: styles.gallery,\n        children: gallery.map((item, index) => /*#__PURE__*/_jsxDEV(\"div\", {\n          className: styles.block,\n          children: [/*#__PURE__*/_jsxDEV(GalleryItem, {\n            src: item,\n            onClick: toggleStyle,\n            active: item === toggleItem\n          }, index, false, {\n            fileName: _jsxFileName,\n            lineNumber: 161,\n            columnNumber: 21\n          }, this), /*#__PURE__*/_jsxDEV(DeleteButton, {\n            id: item,\n            onClick: onDelete\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 162,\n            columnNumber: 21\n          }, this)]\n        }, item, true, {\n          fileName: _jsxFileName,\n          lineNumber: 160,\n          columnNumber: 17\n        }, this))\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 158,\n        columnNumber: 13\n      }, this), /*#__PURE__*/_jsxDEV(LoadImage, {\n        addNewImg: addNewImg\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 165,\n        columnNumber: 9\n      }, this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 156,\n      columnNumber: 9\n    }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n      className: styles.canvasWrapper,\n      children: [/*#__PURE__*/_jsxDEV(\"header\", {\n        className: styles.canvas__heading,\n        children: \"Grafic Editor\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 168,\n        columnNumber: 9\n      }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n        className: styles.graficEditor,\n        children: [/*#__PURE__*/_jsxDEV(\"div\", {\n          className: styles.tools,\n          children: [/*#__PURE__*/_jsxDEV(LineWidthBar, {\n            onChangeLineWidth: onChangeLineWidth,\n            value: lineWidth\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 171,\n            columnNumber: 21\n          }, this), /*#__PURE__*/_jsxDEV(Button, {\n            onClick: eraser,\n            id: 'eraser',\n            text: 'eraser'\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 172,\n            columnNumber: 21\n          }, this), /*#__PURE__*/_jsxDEV(Button, {\n            onClick: clear,\n            id: 'clear',\n            text: 'clear'\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 173,\n            columnNumber: 21\n          }, this), /*#__PURE__*/_jsxDEV(Button, {\n            onClick: undo,\n            id: 'undo',\n            text: 'undo'\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 174,\n            columnNumber: 21\n          }, this), /*#__PURE__*/_jsxDEV(Button, {\n            onClick: save,\n            id: 'save',\n            text: 'save'\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 175,\n            columnNumber: 21\n          }, this)]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 170,\n          columnNumber: 13\n        }, this), /*#__PURE__*/_jsxDEV(\"img\", {\n          src: face,\n          alt: \"face\",\n          className: styles.facePattern\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 177,\n          columnNumber: 13\n        }, this), /*#__PURE__*/_jsxDEV(\"canvas\", {\n          width: \"450\",\n          height: \"450\",\n          className: styles.painter,\n          ref: canvasRef,\n          ...props\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 178,\n          columnNumber: 13\n        }, this), /*#__PURE__*/_jsxDEV(Palette, {\n          onChangeColor: onChangeColor\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 179,\n          columnNumber: 13\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 169,\n        columnNumber: 9\n      }, this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 167,\n      columnNumber: 5\n    }, this)]\n  }, void 0, true, {\n    fileName: _jsxFileName,\n    lineNumber: 155,\n    columnNumber: 10\n  }, this);\n};\n\n_s2(Canvas, \"Mp/id86/c2GLvAGJQE+CSNPlqgk=\", false, function () {\n  return [useLocalStorage];\n});\n\n_c = Canvas;\nexport default Canvas;\n\nvar _c;\n\n$RefreshReg$(_c, \"Canvas\");","map":{"version":3,"sources":["/home/namina/courses/tinkoff/paint-your-face/src/components/graficEditor/GraficEditor.js"],"names":["React","useRef","useEffect","useState","useCallback","Palette","Button","LineWidthBar","GalleryItem","DeleteButton","LoadImage","faceCanvas","face","styles","useLocalStorage","key","initialValue","storedValue","setStoredValue","item","window","localStorage","getItem","JSON","parse","error","console","log","setValue","value","valueToStore","Function","setItem","stringify","Canvas","props","faceCam","setFace","color","setColor","gallery","setImage","paths","setPath","lineWidth","setLineWidth","toggleItem","setToggle","canvasRef","draw","canvas","mode","rememberPath","points","context","getContext","globalCompositeOperation","onmousemove","drawIfPressed","e","x","offsetX","y","offsetY","dx","movementX","dy","movementY","lineCap","buttons","beginPath","moveTo","lineTo","stroke","strokeStyle","closePath","push","onmouseup","onmousedown","drawPaths","clearRect","width","height","forEach","path","i","length","onChangeLineWidth","onChangeColor","save","current","dataURL","toDataURL","includes","clear","eraser","undo","splice","toggleStyle","updateTexture","addNewImg","onDelete","prevActions","filter","alert","undefined","paintWrapper","galleryWrapper","gallery__heading","map","index","block","canvasWrapper","canvas__heading","graficEditor","tools","facePattern","painter"],"mappings":"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","sourcesContent":["import React, { useRef, useEffect, useState, useCallback } from 'react';\nimport Palette from '../Palette/Palette';\nimport Button from '../Buttons';\nimport LineWidthBar from '../LineWidthBar';\nimport GalleryItem from '../addNewImage';\nimport DeleteButton from '../DeleteButton';\nimport LoadImage from '../LoadImage';\n//import FacePaint from '../FaceMash/FacePaint';\nimport {faceCanvas} from '../FaceMash/camera';\nimport face from '../images/face.png'\n\nimport styles from './gallery/Gallery.module.css';\n\nfunction useLocalStorage(key, initialValue) {\n    const [storedValue, setStoredValue] = useState(() => {\n        try {\n            const item = window.localStorage.getItem(key);\n            return item ? JSON.parse(item) : initialValue;\n        } catch (error) {\n            console.log(error);\n            return initialValue;\n        }\n});\n    const setValue = (value) => {\n        try {\n            const valueToStore =\n                value instanceof Function ? value(storedValue) : value;\n            setStoredValue(valueToStore);\n            window.localStorage.setItem(key, JSON.stringify(valueToStore));\n        } catch (error) {\n            console.log(error);\n        }\n    };\n    return [storedValue, setValue];\n};\n\nconst Canvas = props => {\n    let [faceCam, setFace]=useState(faceCanvas);\n    let [color, setColor] = useState('black');\n    let [gallery, setImage] = useLocalStorage('gallery', []);\n    let [paths, setPath] = useState([]);\n    let [lineWidth, setLineWidth] = useState(2);\n    let [toggleItem, setToggle] = useState([]);\n    const canvasRef = useRef(null);\n    const draw = useCallback((canvas, color, mode) => {\n        let rememberPath = false;\n        let points = [];\n        let context = canvas.getContext('2d');\n        context.globalCompositeOperation = mode ==='line'? \"source-over\": \"destination-out\";\n        canvas.onmousemove = function drawIfPressed (e) {\n            let x = e.offsetX;\n            let y = e.offsetY;\n            let dx = e.movementX;\n            let dy = e.movementY;\n            context.lineCap = \"round\";\n            context.lineWidth = lineWidth;\n            if (e.buttons > 0) {\n              context.beginPath();\n              context.moveTo(x, y);\n              context.lineTo(x - dx, y - dy);\n              context.stroke();\n              context.strokeStyle = color;\n              context.closePath();\n            }\n            if(rememberPath){\n                points.push({x:x-dx, y:y-dy, color: color, lineWidth: lineWidth})\n            }\n            canvas.onmouseup = (e) => {//не нажата\n                setPath([...paths, points])\n                rememberPath = false;\n            };\n            canvas.onmousedown = (e)=>{//нажата\n                let x = e.offsetX;\n                let y = e.offsetY;\n                let dx = e.movementX;\n                let dy = e.movementY;\n                points = [];\n                rememberPath = true;\n                points.push({x:x-dx,y:y-dy})\n            };\n        }\n        }, [lineWidth, paths]); \n        \n    \n    const drawPaths = (canvas)=> {\n        let context = canvas.getContext('2d');\n        context.clearRect(0,0,canvas.width,canvas.height);\n        paths.forEach(path=>{\n        context.beginPath();\n        context.moveTo(path[0].x,path[0].y); \n        for(let i = 1; i < path.length; i++){\n            context.lineTo(path[i].x,path[i].y); \n            context.strokeStyle = path[i].color;\n            context.lineWidth = path[i].lineWidth;\n        }\n        context.stroke();\n        })\n    };\n\n    const onChangeLineWidth = width => setLineWidth(width); \n    const onChangeColor = color => setColor(color);\n    const save = () => {\n        const canvas = canvasRef.current;\n        let dataURL = canvas.toDataURL(\"image/png\", 1.0);\n        if(localStorage.getItem('gallery') === null || localStorage.getItem('gallery').includes(dataURL) !== true) {//картинку сохраняем один раз\n            setImage([...gallery,dataURL]);\n        }\n        \n    };\n    const clear = () => {\n        const canvas = canvasRef.current\n        const context = canvas.getContext('2d');\n        context.clearRect(0, 0, canvas.width, canvas.height);\n        setPath([]);\n    };\n    const eraser = () => {\n        const canvas = canvasRef.current\n        draw(canvas,\"rgb(255, 255, 255, 1)\",'eraser');\n    };\n    const undo = () => {\n        const canvas = canvasRef.current;\n        paths.splice(-1,1);\n        drawPaths(canvas);\n    }\n    const toggleStyle =  (value) => {\n        //alert(JSON.stringify( props))\n        setToggle(value);\n        faceCanvas.updateTexture(value);\n        /*if(faceCanvas!==undefined){\n            faceCanvas.updateTexture(value);\n        }\n        else{\n            alert('loading')\n        }*/\n    };\n   \n    const addNewImg = (dataURL) => {\n       setImage([...gallery, dataURL]);\n\n    } \n    const onDelete= (item) => {\n        setImage(prevActions => (\n            prevActions.filter(value => value !== item)\n        ));\n    };\n      \n    useEffect(() => {\n        const canvas = canvasRef.current;\n        alert(faceCam===undefined)\n        draw(canvas, color,'line');\n\n    }, [ draw, color, gallery, paths, lineWidth, toggleStyle, faceCam]);\n//, lineWidth, toggleStyle  \n  \n  return <section className={styles.paintWrapper}>\n        <div className={styles.galleryWrapper}>\n            <header className={styles.gallery__heading}>Gallery</header>\n            <div className={styles.gallery}>{\n                gallery.map((item, index)=> \n                <div className={styles.block} key={item}>\n                    <GalleryItem key={index}  src={item}  onClick={toggleStyle} active={(item) === toggleItem}/>\n                    <DeleteButton id={item} onClick={onDelete}/>\n                </div>)\n        }</div>\n        <LoadImage addNewImg={addNewImg}/>\n    </div>\n    <div className={styles.canvasWrapper}>\n        <header className={styles.canvas__heading}>Grafic Editor</header>\n        <div className={styles.graficEditor}>\n            <div className={styles.tools}>\n                    <LineWidthBar onChangeLineWidth={onChangeLineWidth} value={lineWidth}/> \n                    <Button onClick={eraser} id={'eraser'} text={'eraser'}/>\n                    <Button onClick={clear} id={'clear'} text={'clear'}/>\n                    <Button onClick={undo} id={'undo'} text={'undo'}/>\n                    <Button onClick={save} id={'save'} text={'save'}/>\n            </div>\n            <img src={face} alt='face' className={styles.facePattern}/>\n            <canvas width=\"450\" height=\"450\" className={styles.painter} ref={canvasRef} {...props}/>\n            <Palette onChangeColor={onChangeColor}></Palette>\n        </div>\n    </div>\n</section>;\n}\nexport default Canvas;\n"]},"metadata":{},"sourceType":"module"}